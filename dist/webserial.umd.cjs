(function(y,f){typeof exports=="object"&&typeof module<"u"?f(exports):typeof define=="function"&&define.amd?define(["exports"],f):(y=typeof globalThis<"u"?globalThis:y||self,f(y.WebSerial={}))})(this,function(y){"use strict";var tn=Object.defineProperty;var Re=y=>{throw TypeError(y)};var nn=(y,f,S)=>f in y?tn(y,f,{enumerable:!0,configurable:!0,writable:!0,value:S}):y[f]=S;var q=(y,f,S)=>nn(y,typeof f!="symbol"?f+"":f,S),we=(y,f,S)=>f.has(y)||Re("Cannot "+S);var b=(y,f,S)=>(we(y,f,"read from private field"),S?S.call(y):f.get(y)),B=(y,f,S)=>f.has(y)?Re("Cannot add the same private member more than once"):f instanceof WeakSet?f.add(y):f.set(y,S),T=(y,f,S,re)=>(we(y,f,"write to private field"),re?re.call(y,S):f.set(y,S),S),i=(y,f,S)=>(we(y,f,"access private method"),S);var R,L,a,qe,Ae,_,ye,C,m,oe,p,ke,te,w,He,ve,z,Le,Oe,je,Ue,We,Qe,Je,Ve,ze,Ge,Ye,$e,X,ae,Ke,N,E,W,v,Xe,Ze,et,me,ne,G,le,ce,ue,l,tt,nt,it,A,M,rt,st,at,ot,lt,ct,ut,ht,j,F,he,P,U,dt,pt,_t,ft,ie,ge,Ce,de,pe,bt,Z,V,$,u,wt,yt,_e,kt,vt,mt,gt,Ct,Tt,Dt,xt,Te,St,It,Et,Mt,Ft,Pt,Nt,Bt,Rt,qt,At,Ht,Lt,Ot,H,fe,jt,Ut,Wt,Qt,De,be,Jt,Vt,xe,Se,Ie;for(var f=[],S=0;S<256;++S)f.push((S+256).toString(16).slice(1));function re(g,s=0){return(f[g[s+0]]+f[g[s+1]]+f[g[s+2]]+f[g[s+3]]+"-"+f[g[s+4]]+f[g[s+5]]+"-"+f[g[s+6]]+f[g[s+7]]+"-"+f[g[s+8]]+f[g[s+9]]+"-"+f[g[s+10]]+f[g[s+11]]+f[g[s+12]]+f[g[s+13]]+f[g[s+14]]+f[g[s+15]]).toLowerCase()}var se,zt=new Uint8Array(16);function Gt(){if(!se&&(se=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!se))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return se(zt)}var Yt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Ee={randomUUID:Yt};function $t(g,s,t){if(Ee.randomUUID&&!s&&!g)return Ee.randomUUID();g=g||{};var e=g.random||(g.rng||Gt)();return e[6]=e[6]&15|64,e[8]=e[8]&63|128,re(e)}class Kt extends EventTarget{constructor(){super(...arguments);q(this,"__listeners__",{})}dispatch(t,e=null){const n=new Xt(t,{detail:e});this.dispatchEvent(n)}dispatchAsync(t,e=null,n=100){const o=this;setTimeout(()=>{o.dispatch(t,e)},n)}on(t,e){typeof this.__listeners__[t]<"u"&&this.__listeners__[t]===!1&&(this.__listeners__[t]=!0),this.addEventListener(t,e)}serialRegisterAvailableListener(t){this.__listeners__[t]||(this.__listeners__[t]=!1)}get availableListeners(){return Object.keys(this.__listeners__).sort().map(e=>({type:e,listening:this.__listeners__[e]}))}}class Xt extends CustomEvent{constructor(s,t){super(s,t)}}function J(g=100){return new Promise(s=>setTimeout(()=>s(),g))}function Zt(){return"serial"in navigator}function Me(g=1){return g*1e3}const r=class r{static status(s=null){var e,n;if(!i(e=r,a,_).call(e,s))return!1;let t=[];switch(b(r,R)){case"locker":t=["0","8"];break;case"boardroid":t=["2",(5+b(r,L)).toString(16).toUpperCase()];break;case"jofemar":t=["6"];break;default:return!1}i(n=r,a,p).call(n,t)}static dispensed(s=null){var e,n;if(!i(e=r,a,_).call(e,s))return!1;let t=[];switch(b(r,R)){case"locker":t=["0","7","4","4","4"];break;case"boardroid":t=["2","D7","A","0","0","0","0","0","0","0","0","0","F2"];break;case"jofemar":t=["6","30"];break;default:return!1}i(n=r,a,p).call(n,t)}static notDispensed(s=null){var e,n;if(!i(e=r,a,_).call(e,s))return!1;let t=[];switch(b(r,R)){case"locker":t=["0","7","5","5","5"];break;case"boardroid":t=["2","D7","A","0","0","1","0","0","0","0","0","0","F2"];break;case"jofemar":t=["6","34"];break;default:return!1}i(n=r,a,p).call(n,t)}static gateInactive(s=null){var t;if(!i(t=r,a,_).call(t,s)||!i(this,a,ye).call(this))return!1;i(this,a,p).call(this,["0","7","5","5","5"])}static gateConfigured(s=null){var t;if(!i(t=r,a,_).call(t,s)||!i(this,a,ye).call(this))return!1;i(this,a,p).call(this,["0","6"])}static keyPressed(s=null){var o,c,d;if(!i(o=r,a,_).call(o,s)||!i(c=r,a,m).call(c))return!1;const t=["30","31","32","33","34","35","36","37","38","39","2A","23","41","42","43","44"],e=(128+b(r,L)).toString(16),n=Math.floor(Math.random()*15);i(d=r,a,p).call(d,["2",e,"54",t[n]])}static doorOpened(s=null){var n,o;if(!i(n=r,a,_).call(n,s)||!i(this,a,oe).call(this))return!1;let t=[];const e=(128+b(r,L)).toString(16);switch(b(r,R)){case"boardroid":t=["2","D8","dc"];break;case"jofemar":t=["2",e,"50","4F"];break}i(o=r,a,p).call(o,t)}static doorClosed(s=null){var n,o;if(!i(n=r,a,_).call(n,s)||!i(this,a,oe).call(this))return!1;let t=[];const e=(128+b(r,L)).toString(16);switch(b(r,R)){case"boardroid":t=["2","D8","db"];break;case"jofemar":t=["2",e,"50","43"];break}i(o=r,a,p).call(o,t)}static channelDisconnected(s=null){var e,n,o;if(!i(e=r,a,_).call(e,s)||!i(n=r,a,m).call(n))return!1;const t=(128+b(r,L)).toString(16);i(o=r,a,p).call(o,["2",t,"43","43","43","FD"])}static channelConnected(s=null){var e,n,o;if(!i(e=r,a,_).call(e,s)||!i(n=r,a,m).call(n))return!1;const t=(128+b(r,L)).toString(16);i(o=r,a,p).call(o,["2",t,"43","43","43","FC"])}static channelEmpty(s=null){var e,n,o;if(!i(e=r,a,_).call(e,s)||!i(n=r,a,m).call(n))return!1;const t=(128+b(r,L)).toString(16);i(o=r,a,p).call(o,["2",t,"43","43","43","FF"])}static workingTemperature(s=null){var e,n,o;if(!i(e=r,a,_).call(e,s)||!i(n=r,a,m).call(n))return!1;const t=(128+b(r,L)).toString(16);i(o=r,a,p).call(o,["2",t,"43","54","16"])}static currentTemperature(s=null){var n,o,c;if(!i(n=r,a,_).call(n,s)||!i(o=r,a,oe).call(o))return!1;let t=[];const e=(128+b(r,L)).toString(16);switch(b(r,R)){case"boardroid":t=["2","D9","44","30"];break;case"jofemar":t=["2",e,"43","74","2B","30","39","2E","31","7F","43"];break}i(c=r,a,p).call(c,t)}static ready(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","30"])}static busy(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","31"])}static invalidTray(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","32"])}static invalidChannel(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","33"])}static emptyChannel(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","34"])}static elevatorJam(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","35"])}static elevatorMalfunction(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","36"])}static phototransistorFailure(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","37"])}static allChannelsEmpty(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","38"])}static productDetectorFailure(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","39"])}static displayDisconnected(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","41"])}static productUnderElevator(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","42"])}static elevatorSettingAlarm(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","43"])}static buttonPanelFailure(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","44"])}static errorWritingEeprom(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","45"])}static errorControlTemperature(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","46"])}static thermometerDisconnected(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","47"])}static thermometerMisconfigured(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","48"])}static thermometerFailure(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","49"])}static errorExtractorConsumption(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","4A"])}static channelSearchError(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","4B"])}static productExitMouthSearchError(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","4C"])}static elevatorInteriorLocked(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","4D"])}static productDetectorVerifierError(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","4E"])}static waitingForProductRecall(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","4F"])}static productExpiredByTemperature(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","50"])}static faultyAutomaticDoor(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","51"])}static rejectLever(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","A0","1"])}static resetCoinPurse(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","A0","2"])}static coinInsertedBox(s=null,t=null){var o,c,d,h;if(!i(o=r,a,_).call(o,s)||!i(c=r,a,C).call(c))return!1;const e=["40","41","42","43","44","45"],n=i(d=r,a,ke).call(d,e,t);i(h=r,a,p).call(h,["2","A0",n])}static coinInsertedTube(s=null,t=null){var o,c,d,h;if(!i(o=r,a,_).call(o,s)||!i(c=r,a,C).call(c))return!1;const e=["50","51","52","53","54","55"],n=i(d=r,a,ke).call(d,e,t);i(h=r,a,p).call(h,["2","A0",n])}static banknoteInsertedStacker(s=null,t=null){var o,c,d,h;if(!i(o=r,a,_).call(o,s)||!i(c=r,a,C).call(c))return!1;const e=["80","81","82","83","84"],n=i(d=r,a,te).call(d,e,t);i(h=r,a,p).call(h,["2","B0",n])}static banknoteInsertedEscrow(s=null,t=null){var o,c,d,h;if(!i(o=r,a,_).call(o,s)||!i(c=r,a,C).call(c))return!1;const e=["90","91","92","93","94"],n=i(d=r,a,te).call(d,e,t);i(h=r,a,p).call(h,["2","B0",n])}static banknoteEjected(s=null,t=null){var o,c,d,h;if(!i(o=r,a,_).call(o,s)||!i(c=r,a,C).call(c))return!1;const e=["A0","A1","A2","A3","A4"],n=i(d=r,a,te).call(d,e,t);i(h=r,a,p).call(h,["2","B0",n])}static banknoteInsertedRecycler(s=null,t=null){var o,c,d,h;if(!i(o=r,a,_).call(o,s)||!i(c=r,a,C).call(c))return!1;const e=["B0","B1","B2","B3","B4"],n=i(d=r,a,te).call(d,e,t);i(h=r,a,p).call(h,["2","B0",n])}static banknoteTaken(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","B0","2a"])}static coinPurseEnabled(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","D0","1"])}static coinPurseDisabled(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","D0","0"])}static billPurseDisabled(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","D1","0","0"])}static billPurseEnabled(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","D1","1","1"])}static readTubes(s=null){var k,x,I;if(!i(k=r,a,_).call(k,s)||!i(x=r,a,C).call(x))return!1;const t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f"],[e,n,o,c,d,h]=[t[Math.floor(Math.random()*30)],t[Math.floor(Math.random()*30)],t[Math.floor(Math.random()*30)],t[Math.floor(Math.random()*30)],t[Math.floor(Math.random()*30)],t[Math.floor(Math.random()*30)]];i(I=r,a,p).call(I,["2","D2",e,n,o,c,d,h])}static readBillPurse(s=null,t=null){var n,o,c,d;if(!i(n=r,a,_).call(n,s)||!i(o=r,a,C).call(o))return!1;let e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c"];if(s._recycler.ict){const h=e[Math.floor(Math.random()*31)];let k="0",x="0",I="0",O="0",ee="0";if(t!==null&&!isNaN(parseInt(t)))switch(t.toString()){case"20":k=h;break;case"50":x=h;break;case"100":I=h;break;case"200":O=h;break;case"500":ee=h;break}else switch(s._recycler.bill){case 0:k=h;break;case 1:x=h;break;case 2:I=h;break;case 3:O=h;break;case 4:ee=h;break}i(c=r,a,p).call(c,["2","D3",k,x,I,O,ee,"0"])}else{const[h,k,x,I,O,ee]=[e[Math.floor(Math.random()*30)],e[Math.floor(Math.random()*30)],e[Math.floor(Math.random()*30)],e[Math.floor(Math.random()*2)],e[Math.floor(Math.random())],e[Math.floor(Math.random())]];i(d=r,a,p).call(d,["2","D3",h,k,x,I,O,ee])}}static banknoteAccepted(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","D4","1"])}static banknoteRejected(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","D4","0"])}static banknotesDispensed(s=null){var e,n,o,c;if(!i(e=r,a,_).call(e,s)||!i(n=r,a,C).call(n))return!1;let t=["1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c"];if(s._recycler.ict){const d=t[Math.floor(Math.random()*30)];let h="0",k="0",x="0",I="0",O="0";switch(s._recycler.bill){case 0:h=d;break;case 1:k=d;break;case 2:x=d;break;case 3:I=d;break;case 4:O=d;break}i(o=r,a,p).call(o,["2","D5",h,k,x,I,O,"0"])}else{const[d,h,k,x,I,O]=[t[Math.floor(Math.random()*30)],t[Math.floor(Math.random()*30)],t[Math.floor(Math.random()*30)],t[Math.floor(Math.random()*2)],t[Math.floor(Math.random())],t[Math.floor(Math.random())]];i(c=r,a,p).call(c,["2","D5",d,h,k,x,I,O])}}static coinsDispensed(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","D6"])}static relayOn(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DA","1"])}static relayOff(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DA","0"])}static nayaxEnabled(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","1"])}static nayaxDisabled(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","0"])}static nayaxPreCreditAuthorized(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","3"])}static nayaxCancelRequest(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","4"])}static nayaxSellApproved(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","5"])}static nayaxSellDenied(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","6"])}static nayaxEndSession(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","7"])}static nayaxCancelled(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","8"])}static nayaxDispensed(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","A","0"])}static nayaxNotDispensed(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,C).call(e))return!1;i(n=r,a,p).call(n,["2","DD","A","1"])}static fullTray(s=null){var t,e,n;if(!i(t=r,a,_).call(t,s)||!i(e=r,a,m).call(e))return!1;i(n=r,a,p).call(n,["6","4F"])}static setConnection(s=null){var t;if(!i(t=r,a,_).call(t,s))return!1;s.__internal__.serial.connected=!0}};R=new WeakMap,L=new WeakMap,a=new WeakSet,qe=function(){if(r.enable===!1)throw new Error("Emulator is disabled");return r.enable},Ae=function(s){if(typeof s!="object"||!(s instanceof K))throw new Error(`Type ${s.typeDevice} is not supported`);return r.instance=s,T(r,R,s.typeDevice),T(r,L,s.deviceNumber),!0},_=function(s=null){var t,e;return!i(t=r,a,qe).call(t)||s===null&&r.instance===null?!1:(r.instance===null&&i(e=r,a,Ae).call(e,s),!0)},ye=function(){if(b(r,R)!=="locker")throw new Error("This function is only available for Locker devices");return!0},C=function(){if(b(r,R)!=="boardroid")throw new Error("This function is only available for Boardroid devices");return!0},m=function(){if(b(r,R)!=="jofemar")throw new Error("This function is only available for Jofemar devices");return!0},oe=function(){if(b(r,R)==="locker")throw new Error("This function is not available for Locker devices");return!0},p=function(s){r.instance.__emulate({code:s})},ke=function(s,t=null){let e=s[Math.floor(Math.random()*5)];if(t!==null&&!isNaN(parseFloat(t)))switch(t.toString()){case"0.5":e=s[1];break;case"1":e=s[2];break;case"2":e=s[3];break;case"5":e=s[4];break;case"10":e=s[5];break}return e},te=function(s,t=null){let e=s[Math.floor(Math.random()*4)];if(t!==null&&!isNaN(parseFloat(t)))switch(t.toString()){case"20":e=s[0];break;case"50":e=s[1];break;case"100":e=s[2];break;case"200":e=s[3];break;case"500":e=s[4];break}return e},B(r,a),q(r,"enable",!1),q(r,"instance",null),B(r,R,null),B(r,L,1);let Y=r;class K extends Kt{constructor({filters:t=null,config_port:e=null,no_device:n=1,device_listen_on_port:o=1}={}){super();B(this,w);q(this,"__internal__",{device_number:1,aux_port_connector:0,last_error:{message:null,action:null,code:null,no_code:0},serial:{connected:!1,port:null,response:{length:null,buffer:new Uint8Array([])},reader:null,input_done:null,output_done:null,input_stream:null,output_stream:null,keep_reading:!0,time_until_send_bytes:void 0,bytes_connection:null,filters:[],config_port:{baudRate:9600,dataBits:8,stopBits:1,parity:"none",bufferSize:32768,flowControl:"none"},queue:[]},device:{type:"unknown",id:$t(),listen_on_port:null},time:{response_connection:500,response_general:2e3,sense:100},timeout:{until_response:0},interval:{reconnection:0,waiting_sense:0},dispense:{dispensing:!1,status:null,counter:0,limit_counter:20,backup_dispense:{}}});t&&(this.serialFilters=t),e&&(this.serialConfigPort=e),n&&i(this,w,Ye).call(this,n),o&&(typeof o=="number"||typeof o=="string")&&(this.listenOnPort=o),i(this,w,Je).call(this),i(this,w,Ve).call(this)}set listenOnPort(t){if(t=parseInt(t),isNaN(t)||t<1||t>255)throw new Error("Invalid port number");this.__internal__.device.listen_on_port=t,this.__internal__.serial.bytes_connection=this.serialSetConnectionConstant(t)}get listenOnPort(){return this.__internal__.device.listen_on_port??1}set serialFilters(t){this.__internal__.serial.filters=t}get serialFilters(){return this.__internal__.serial.filters}set serialConfigPort(t){this.__internal__.serial.config_port=t}get serialConfigPort(){return this.__internal__.serial.config_port}get isConnected(){return this.__internal__.serial.connected}get isDisconnected(){return!this.__internal__.serial.connected}get deviceNumber(){return this.__internal__.device_number}get uuid(){return this.__internal__.device.id}get typeDevice(){return this.__internal__.device.type}get queue(){return this.__internal__.serial.queue}async timeout(t,e){this.__internal__.last_error.message="Operation response timed out.",this.__internal__.last_error.action=e,this.__internal__.last_error.code=t,this.__internal__.timeout.until_response&&(clearTimeout(this.__internal__.timeout.until_response),this.__internal__.timeout.until_response=0),e==="connect"?(this.__internal__.serial.connected=!1,this.dispatch("serial:reconnect",{})):e==="connection:start"?(await this.serialDisconnect(),this.__internal__.serial.connected=!1,this.__internal__.aux_port_connector+=1,await this.serialConnect()):e==="dispense"&&(this.__internal__.dispense.status="no-response"),this.dispatch("serial:timeout",{...this.__internal__.last_error,bytes:t,action:e})}async disconnect(t=null){await this.serialDisconnect(),this.__internal__.serial.connected=!1,this.__internal__.aux_port_connector=0,this.dispatch("serial:disconnected",t)}async connect(){return new Promise((t,e)=>{Zt()||e("Web Serial not supported"),setTimeout(async()=>{await J(499),await this.serialConnect(),this.isConnected?t(`${this.typeDevice} device ${this.deviceNumber} connected`):e(`${this.typeDevice} device ${this.deviceNumber} not connected`)},1)})}async serialDisconnect(){try{const t=this.__internal__.serial.reader,e=this.__internal__.serial.output_stream;t&&(await t.cancel().catch(o=>this.serialErrors(o)),await this.__internal__.serial.input_done),e&&(await e.getWriter().close(),await this.__internal__.serial.output_done),this.__internal__.serial.connected&&this.__internal__.serial&&await this.__internal__.serial.port.close()}catch(t){this.serialErrors(t)}finally{this.__internal__.serial.reader=null,this.__internal__.serial.input_done=null,this.__internal__.serial.output_stream=null,this.__internal__.serial.output_done=null,this.__internal__.serial.connected=!1,this.__internal__.serial.port=null}}async serialPortsSaved(t){const e=this.serialFilters;if(this.__internal__.aux_port_connector<t.length){const n=this.__internal__.aux_port_connector;this.__internal__.serial.port=t[n]}else this.__internal__.aux_port_connector=0,this.__internal__.serial.port=await navigator.serial.requestPort({filters:e});if(!this.__internal__.serial.port)throw new Error("Select another port please")}serialErrors(t){const e=t.toString().toLowerCase();switch(!0){case e.includes("must be handling a user gesture to show a permission request"):case e.includes("the port is closed."):case e.includes("select another port please"):case e.includes("no port selected by the user"):case e.includes("this readable stream reader has been released and cannot be used to cancel its previous owner stream"):this.dispatch("serial:need-permission",{});break;case e.includes("the port is already open."):this.serialDisconnect().then(async()=>{this.__internal__.aux_port_connector+=1,await this.serialConnect()});break;case e.includes("cannot read properties of undefined (reading 'writable')"):case e.includes("cannot read properties of null (reading 'writable')"):case e.includes("cannot read property 'writable' of null"):case e.includes("cannot read property 'writable' of undefined"):case e.includes("failed to open serial port"):this.serialDisconnect().then(async()=>{await this.serialConnect()});break;case e.includes("'close' on 'serialport': a call to close() is already in progress."):break;case e.includes("failed to execute 'open' on 'serialport': a call to open() is already in progress."):break;case e.includes("the port is already closed."):break;case e.includes("the device has been lost"):this.dispatch("serial:lost",{});break;case e.includes("navigator.serial is undefined"):this.dispatch("serial:unsupported",{});break;default:console.error(t);break}this.dispatch("serial:error",t)}async serialConnect(){try{this.dispatch("serial:connecting",{});const t=await i(this,w,Le).call(this);if(t.length>0)await this.serialPortsSaved(t);else{const o=this.serialFilters;this.__internal__.serial.port=await navigator.serial.requestPort({filters:o})}const e=this.__internal__.serial.port;await e.open(this.serialConfigPort);const n=this;e.onconnect=o=>{n.dispatch("serial:connected",o.detail),n.__internal__.serial.queue.length>0&&n.dispatch("internal:queue",{})},e.ondisconnect=async o=>{await n.disconnect(o.detail??null)},this.__internal__.timeout.until_response=setTimeout(async()=>{await n.timeout(n.__internal__.serial.bytes_connection,"connection:start")},this.__internal__.time.response_connection),await i(this,w,ve).call(this,this.__internal__.serial.bytes_connection),this.dispatch("serial:sent",{action:"connect",bytes:this.__internal__.serial.bytes_connection}),this.typeDevice==="relay"&&i(this,w,z).call(this,["DD","DD"],null),await i(this,w,We).call(this)}catch(t){this.serialErrors(t)}}async serialForget(){return await i(this,w,Qe).call(this)}decToHex(t){return parseInt(t,10).toString(16)}hexToDec(t){return parseInt(t,16).toString(10)}hexMaker(t="00",e=2){return t.toString().padStart(e,"0").toLowerCase()}add0x(t){let e=[];return t.forEach((n,o)=>{e[o]="0x"+n}),e}bytesToHex(t){return this.add0x(Array.from(t,e=>this.hexMaker(e)))}async appendToQueue(t,e){const n=this.bytesToHex(t);if(["connect","connection:start"].includes(e)){if(this.__internal__.serial.connected)return;await this.serialConnect();return}this.__internal__.serial.queue.push({bytes:n,action:e}),this.dispatch("internal:queue",{})}serialSetConnectionConstant(t=1){throw new Error("Method not implemented")}serialMessage(t){throw new Error("Method not implemented")}serialCorruptMessage(t,e){throw new Error("Method not implemented")}clearSerialQueue(){this.__internal__.serial.queue=[]}sumHex(t){let e=0;return t.forEach(n=>{e+=parseInt(n,16)}),e.toString(16)}get isDispensing(){return this.__internal__.interval.waiting_sense||this.__internal__.dispense.dispensing}internalClearSensing(){this.__internal__.interval.waiting_sense&&clearInterval(this.__internal__.interval.waiting_sense),this.__internal__.interval.waiting_sense=0,this.__internal__.dispense.status=null,this.__internal__.dispense.counter=0,this.__internal__.dispense.dispensing=!1}internalDispensingProcess(){return this.__internal__.dispense.counter>=this.__internal__.dispense.limit_counter?(this.internalClearSensing(),this.__internal__.dispense.status=!1,this.__internal__.dispense.dispensing=!1,!1):(this.__internal__.dispense.counter+=.1,this.__internal__.dispense.counter%1===0&&this.dispatch("dispensing",{status:this.__internal__.dispense.status,counter:this.__internal__.dispense.counter,limit:this.__internal__.dispense.limit_counter}),null)}async internalDispenseStatus(){this.__internal__.dispense.status=null,this.__internal__.dispense.dispensing=!0,this.dispatch("internal:dispense:running",{});const t=this;return new Promise(e=>{this.__internal__.interval.waiting_sense=setInterval(()=>{switch(t.__internal__.dispense.status){case null:t.internalDispensingProcess()===!1&&(t.internalClearSensing(),e({status:!1,error:"timeout"}));break;case!0:t.internalClearSensing(),t.__internal__.dispense.status=!0,e({status:!0,error:null});break;case!1:t.internalClearSensing(),t.__internal__.dispense.status=!1,e({status:!1,error:null});break;case"elevator-locked":t.internalClearSensing(),t.__internal__.dispense.status=!1,e({status:!1,error:"elevator-locked"});break;case"no-response":t.internalClearSensing(),t.__internal__.dispense.status=!1,e({status:!1,error:"no-response"});break}},this.__internal__.time.sense)})}async internalDispense(t){if(this.isDispensing)throw new Error("Another dispensing process is running");if(!Y.enable&&!this.__internal__.serial.connected&&(await this.serialConnect(),!this.__internal__.serial.connected))throw new Error("Serial device not connected");return this.__internal__.serial.queue.length===0?(await this.appendToQueue(t,"dispense"),await this.internalDispenseStatus()):new Promise(e=>{const n=setInterval(async()=>{if(this.__internal__.serial.queue.length>0)return;clearInterval(n),await this.appendToQueue(t,"dispense");const o=await this.internalDispenseStatus();e(o)},100)})}__emulate(t){if(typeof t.code!="object"){console.error("Invalid data to make an emulation");return}this.__internal__.serial.connected||(this.__internal__.serial.connected=!0,this.__internal__.interval.reconnection&&(clearInterval(this.__internal__.interval.reconnection),this.__internal__.interval.reconnection=0)),this.__internal__.timeout.until_response&&(clearTimeout(this.__internal__.timeout.until_response),this.__internal__.timeout.until_response=0);const e=[];for(const n in t.code)e.push(t.code[n].toString().padStart(2,"0").toLowerCase());this.serialMessage(e)}toString(){return JSON.stringify({__class:this.typeDevice,device_number:this.deviceNumber,uuid:this.uuid,connected:this.isConnected,connection:this.__internal__.serial.bytes_connection})}softReload(){i(this,w,$e).call(this),this.dispatch("serial:soft-reload",{})}async sendConnect(){await this.appendToQueue(this.__internal__.serial.bytes_connection,"connect")}async sendCustomCode(t){await this.appendToQueue(t,"custom")}}w=new WeakSet,He=function(t){return!!(t.readable&&t.writable)},ve=async function(t){const e=this.__internal__.serial.port;if(!e){if(Y.enable)return;throw new Error("The port is closed.")}const n=new Uint8Array(t),o=e.writable.getWriter();await o.write(n),o.releaseLock()},z=function(t=[],e=null){if(t&&t.length>0){this.__internal__.serial.connected=!0,this.__internal__.interval.reconnection&&(clearInterval(this.__internal__.interval.reconnection),this.__internal__.interval.reconnection=0),this.__internal__.timeout.until_response&&(clearTimeout(this.__internal__.timeout.until_response),this.__internal__.timeout.until_response=0);const n=[];for(const o in t)n.push(t[o].toString().padStart(2,"0").toLowerCase());this.serialMessage(n)}else this.serialCorruptMessage(t,e);this.__internal__.serial.queue.length!==0&&this.dispatch("internal:queue",{})},Le=async function(){const t=this.serialFilters,e=await navigator.serial.getPorts({filters:t});return t.length===0?e:e.filter(o=>{const c=o.getInfo();return t.some(d=>c.usbProductId===d.usbProductId&&c.usbVendorId===d.usbVendorId)}).filter(o=>!i(this,w,He).call(this,o))},Oe=function(t){if(t){const e=this.__internal__.serial.response.buffer;let n=new Uint8Array(e.length+t.byteLength);n.set(e,0),n.set(new Uint8Array(t),e.length),this.__internal__.serial.response.buffer=n}},je=async function(){this.__internal__.serial.time_until_send_bytes&&(clearTimeout(this.__internal__.serial.time_until_send_bytes),this.__internal__.serial.time_until_send_bytes=0),this.__internal__.serial.time_until_send_bytes=setTimeout(()=>{let t=[];for(const e in this.__internal__.serial.response.buffer)t.push(this.__internal__.serial.response.buffer[e].toString(16));this.__internal__.serial.response.buffer&&i(this,w,z).call(this,t),this.__internal__.serial.response.buffer=new Uint8Array(0)},400)},Ue=async function(){if(this.__internal__.serial.response.length===this.__internal__.serial.response.buffer.length){const t=[];for(const e in this.__internal__.serial.response.buffer)t.push(this.__internal__.serial.response.buffer[e].toString(16));await i(this,w,z).call(this,t),this.__internal__.serial.response.buffer=new Uint8Array(0)}else if(this.__internal__.serial.response.length<this.__internal__.serial.response.buffer.length){let t=[];for(let n=0;n<this.__internal__.serial.response.length;n++)t[n]=this.__internal__.serial.response.buffer[n];if(t.length===this.__internal__.serial.response.length){const n=[];for(const o in t)n.push(t[o].toString(16));await i(this,w,z).call(this,n),this.__internal__.serial.response.buffer=new Uint8Array(0);return}t=[];const e=this.__internal__.serial.response.length*2;if(this.__internal__.serial.response.buffer.length===e){for(let n=14;n<e;n++)t[n-this.__internal__.serial.response.length]=this.__internal__.serial.response.buffer[n];if(t.length===this.__internal__.serial.response.length){const n=[];for(const o in t)n.push(t[o].toString(16));await i(this,w,z).call(this,n),this.__internal__.serial.response.buffer=new Uint8Array(0)}}}},We=async function(){const t=this.__internal__.serial.port;for(;t.readable&&this.__internal__.serial.keep_reading;){const e=t.readable.getReader();this.__internal__.serial.reader=e;try{let n=!0;for(;n;){const{value:o,done:c}=await e.read();if(c){e.releaseLock(),this.__internal__.serial.keep_reading=!1,n=!1;break}i(this,w,Oe).call(this,o),this.__internal__.serial.response.length===null?await i(this,w,je).call(this):await i(this,w,Ue).call(this)}}catch(n){this.serialErrors(n)}finally{e.releaseLock()}}this.__internal__.serial.keep_reading=!0,await this.__internal__.serial.port.close()},Qe=async function(){return typeof window>"u"?!1:"serial"in navigator&&"forget"in window.SerialPort.prototype?(await this.__internal__.serial.port.forget(),!0):!1},Je=function(){["serial:connected","serial:connecting","serial:reconnect","serial:timeout","serial:disconnected","serial:sent","serial:soft-reload","serial:message","dispensed","not-dispensed","dispensing","unknown","serial:need-permission","serial:lost","serial:unsupported","serial:error"].forEach(e=>{this.serialRegisterAvailableListener(e)})},Ve=function(){this.on("internal:queue",async()=>{await i(this,w,Ge).call(this)}),i(this,w,ze).call(this)},ze=function(){const t=this;navigator.serial.addEventListener("connect",async()=>{console.log("ara?"),t.isDisconnected&&await t.serialConnect().catch(()=>{})})},Ge=async function(){if(!this.__internal__.serial.connected){await this.serialConnect();return}if(this.__internal__.timeout.until_response||this.__internal__.serial.queue.length===0)return;const t=this.__internal__.serial.queue[0];this.__internal__.timeout.until_response=setTimeout(async()=>{await this.timeout(t.bytes,t.action)},this.__internal__.time.response_general),await i(this,w,ve).call(this,t.bytes),this.dispatch("serial:sent",{action:t.action,bytes:t.bytes}),this.typeDevice==="relay"&&i(this,w,z).call(this,["DD","DD"],null);const e=[...this.__internal__.serial.queue];this.__internal__.serial.queue=e.splice(1)},Ye=function(t=1){this.__internal__.device_number=t,this.__internal__.serial.bytes_connection=this.serialSetConnectionConstant(t)},$e=function(){this.__internal__.last_error={message:null,action:null,code:null,no_code:0}};const D=class D{static typeError(s){const t=new Error;throw t.message=`Type ${s} is not supported`,t.name="DeviceTypeError",t}static addCustom(s,t){typeof D.devices[s]>"u"&&(D.devices[s]=[]),D.add(t)}static add(s){const t=s.typeDevice,e=s.uuid;if(typeof D.devices[t]>"u")return D.typeError(t);if(!D.devices[t][e])return D.devices[t][e]=s,D.devices[t].indexOf(s)}static get(s,t){return typeof D.devices[s]>"u"?D.typeError(s):D.devices[s][t]}static getJofemarByUuid(s){return D.get("jofemar",s)}static getLockerByUuid(s){return D.get("locker",s)}static getRelayByUuid(s){return D.get("relay",s)}static getBoardroidByUuid(s){return D.get("boardroid",s)}static getAll(s=null){return s===null?D.devices:typeof D.devices[s]>"u"?D.typeError(s):D.devices[s]}static getJofemar(s=1){return Object.values(D.devices.jofemar).find(e=>e.deviceNumber===s)??null}static getBoardroid(s=1){return Object.values(D.devices.boardroid).find(e=>e.deviceNumber===s)??null}static getLocker(s=1){return Object.values(D.devices.locker).find(e=>e.deviceNumber===s)??null}static getRelay(s=1){return Object.values(D.devices.relay).find(e=>e.deviceNumber===s)??null}static getCustom(s,t=1){return typeof D.devices[s]>"u"?D.typeError(s):Object.values(D.devices[s]).find(n=>n.deviceNumber===t)??null}};q(D,"devices",{relay:[],locker:[],jofemar:[],boardroid:[]});let Q=D;class Fe extends K{constructor({filters:t=null,config_port:e=null,no_device:n=1}={}){super({filters:t,config_port:e,no_device:n});B(this,ae);B(this,X,{activate:["A0","01","01","A2"],deactivate:["A0","01","00","A1"]});this.__internal__.device.type="relay",i(this,ae,Ke).call(this)}serialMessage(t){const e={code:t,name:null,description:null,request:null,no_code:0};switch(t[1].toString()){case"dd":e.name="Connection with the serial device completed.",e.description="Your connection with the serial device was successfully completed.",e.request="connect",e.no_code=100;break;case"de":break;default:e.name="Unrecognized response",e.description="The response of application was received, but dont identify with any of current parameters",e.request="undefined",e.no_code=400;break}this.dispatch("serial:message",e)}serialRelaySumHex(t){let e=0;return t.forEach((n,o)=>{o!==3&&(e+=parseInt(n,16))}),e.toString(16).toUpperCase()}serialSetConnectionConstant(t=1){const e=["A0","01","00","A1"];return e[1]=this.hexMaker(this.decToHex(t.toString())),e[3]=this.serialRelaySumHex(e),this.add0x(e)}async turnOn(){const t=b(this,X).activate;t[3]=this.serialRelaySumHex(t),await this.appendToQueue(t,"relay:turn-on")}async turnOff(){const t=b(this,X).deactivate;t[3]=this.serialRelaySumHex(t),await this.appendToQueue(t,"relay:turn-off")}async toggle(t=!1,e=300){const n=this;t?(await n.turnOff(),await J(e),await n.turnOn()):(await n.turnOn(),await J(e),await n.turnOff())}}X=new WeakMap,ae=new WeakSet,Ke=function(){Q.add(this)};class Pe extends K{constructor({filters:t=null,config_port:e=null,no_device:n=1,device_listen_on_port:o=3}={}){super({filters:t,config_port:e,no_device:n,device_listen_on_port:o});B(this,v);B(this,N,!1);B(this,E,0);B(this,W,0);this.__internal__.device.type="locker",this.__internal__.device.milliseconds=666,this.__internal__.dispense.limit_counter=1,i(this,v,Ze).call(this),i(this,v,Xe).call(this)}serialMessage(t){const e={code:t,name:null,description:null,request:null,no_code:0};switch(t[1]){case"08":e.name="Connection with the serial device completed.",e.description="Your connection with the serial device was successfully completed.",e.request="connect",e.no_code=100;break;case"07":switch(t[4]){case"00":e.name="Cell closed.",e.description="The selected cell is closed.",e.request="dispense",e.no_code=1102,this.__internal__.dispense.status=!1,this.dispatch("dispensed",{}),b(this,N)&&b(this,E)>=89?(e.finished_test=!0,T(this,N,!1),T(this,E,0)):b(this,N)&&(e.finished_test=!1);break;case"01":case"04":e.name="Cell open.",e.description="The selected cell was open successfully.",e.request="dispense",e.no_code=102,this.__internal__.dispense.status=!0,this.dispatch("dispensed",{}),b(this,N)&&b(this,E)>=89?(e.finished_test=!0,T(this,N,!1),T(this,E,0)):b(this,N)&&(e.finished_test=!1);break;case"05":e.name="Cell inactive.",e.description="The selected cell is inactive or doesn't exist.",e.request="dispense",e.no_code=101,this.__internal__.dispense.status=!1,this.dispatch("not-dispensed",{}),b(this,N)&&b(this,E)>=89?(e.finished_test=!0,T(this,N,!1),T(this,E,0)):b(this,N)&&(e.finished_test=!1);break}break;case"06":e.name="Configuration applied.",e.description="The configuration was successfully applied.",e.request="configure cell",e.no_code=103;break;default:e.request="undefined",e.name="Response unrecognized",e.description="The response of application was received, but dont identify with any of current parameters",e.no_code=400;break}this.dispatch("serial:message",e)}serialSetConnectionConstant(t=3){return this.add0x(this.serialLockerGetConnectionCmd(t))}serialLockerCmdMaker(t){const e=this.__internal__.device.milliseconds;let n=null;try{n=new Uint8Array(t.length+8),n.set(t,2),n[0]=2,n[1]=t.length+4,n[n.length-2]=3;let o=0;for(let h=1;h<t.length;h++)o+=t[h],o*=parseInt(Math.pow(2,h-1).toString());n[t.length+2]=o%256,n[t.length+3]=e*3%256,n[t.length+4]=e*8%256;let c=0;for(let h=3;h<t.length+5;h++)c+=n[h];n[t.length+5]=c%256;let d=0;for(let h=0;h<n.length-1;h++)d^=n[h];n[n.length-1]=d}catch(o){this.serialErrors(`Error generating command: ${o.message}`),n=null}return n}serialLockerHexCmd(t){const e=this.serialLockerCmdMaker(t),n=[];for(let o=0;o<e.length;o++)n.push(this.decToHex(e[o]));return n}serialLockerGetConnectionCmd(t=3){if(t<1||t>255)throw new Error("Invalid port number");return this.serialLockerHexCmd(new Uint8Array([0,t]))}parseCellToColumnRow(t){const e=Math.floor((t-1)/10)+1;let n=t%8;return n===0&&(n=8),[e,n]}async dispense(t){t=i(this,v,ne).call(this,t);const e=i(this,v,et).call(this,t);return await this.internalDispense(e)}async enable(t){t=i(this,v,ne).call(this,t);const[e,n]=this.parseCellToColumnRow(t),o=i(this,v,me).call(this,{enable:!0,column:e,row:n});await this.appendToQueue(o,"activate")}async disable(t){t=i(this,v,ne).call(this,t);const[e,n]=this.parseCellToColumnRow(t),o=i(this,v,me).call(this,{enable:!1,column:e,row:n});await this.appendToQueue(o,"disable")}async openAll(){if(this.isDispensing)throw new Error("Another dispensing process is running");i(this,v,G).call(this),T(this,N,!0),i(this,v,le).call(this);const t=[];for(let e=1;e<=90;e++){const n=await this.dispense(e);t.push(n),T(this,E,e),i(this,v,le).call(this)}T(this,E,90),i(this,v,le).call(this,t),i(this,v,G).call(this)}async enableAll(){i(this,v,G).call(this),T(this,N,!0),i(this,v,ce).call(this);for(let t=1;t<=90;t++)await this.enable(t),T(this,E,t),i(this,v,ce).call(this);T(this,E,90),i(this,v,ce).call(this),i(this,v,G).call(this)}async disableAll(){i(this,v,G).call(this),T(this,N,!0),i(this,v,ue).call(this);for(let t=1;t<=90;t++)await this.enable(t),T(this,E,t),i(this,v,ue).call(this);T(this,E,90),i(this,v,ue).call(this),i(this,v,G).call(this)}}N=new WeakMap,E=new WeakMap,W=new WeakMap,v=new WeakSet,Xe=function(){const t=["percentage:open","percentage:enable","percentage:disable"];for(const e of t)this.serialRegisterAvailableListener(e)},Ze=function(){Q.add(this)},et=function(t=1){return t=i(this,v,ne).call(this,t),this.serialLockerHexCmd(new Uint8Array([16,this.__internal__.device.listen_on_port,t]))},me=function({enable:t=!0,column:e=0,row:n=10}={}){if(e<0||e>8)throw new Error("Invalid column number");if(n<0||n>10)throw new Error("Invalid row number");let o=1;return t||(o=0),this.serialLockerHexCmd(new Uint8Array([48,this.__internal__.device.listen_on_port,e,n,o]))},ne=function(t){const e=parseInt(t);if(isNaN(e)||e<1||e>90)throw new Error("Invalid cell number");return e},G=function(){T(this,N,!1),T(this,E,0),T(this,W,0)},le=function(t=null){T(this,W,Math.round(b(this,E)*100/90)),this.dispatch("percentage:open",{percentage:b(this,W),dispensed:t})},ce=function(){T(this,W,Math.round(b(this,E)*100/90)),this.dispatch("percentage:enable",{percentage:b(this,W)})},ue=function(){T(this,W,Math.round(b(this,E)*100/90)),this.dispatch("percentage:disable",{percentage:b(this,W)})};class Ne extends K{constructor({filters:t=null,config_port:e=null,no_device:n=1,device_listen_on_port:o=1}={}){super({filters:t,config_port:e,no_device:n,device_listen_on_port:o});B(this,l);q(this,"__device",{type:"esplus",support_cart:!1,withdraw:{in_process:!1,seconds:60,interval:0},cart:{in_process:!1},channels:{verification:{clear(){this.running=!1,this.current=1,this.channels=[]},running:!1,start:1,end:80,current:1,channels:[]}}});this.__internal__.device.type="jofemar",this.__internal__.time.response_general=800,this.__internal__.dispense.limit_counter=40,this.__internal__.dispense.timeout=0,this.__internal__.dispense.timeout_time=4e3,this.__internal__.dispense.interval=0,this.__internal__.dispense.interval_time=1e3,this.__internal__.device.hex_number=(128+this.listenOnPort).toString(16),this.__internal__.dispense.elevator={locking_time:60,locking_interval:0,need_reset:!1},i(this,l,tt).call(this),i(this,l,it).call(this),i(this,l,nt).call(this)}set startChannelVerification(t){const e=parseInt(t);if(isNaN(e))throw new Error("Invalid start channel verification, must be a number");if(e<1||e>126)throw new Error("Invalid start channel verification, valid range is 1 to 126");this.__device.channels.verification.start=e}set endChannelVerification(t){const e=parseInt(t);if(isNaN(e))throw new Error("Invalid end channel verification, must be a number");if(e<1||e>126)throw new Error("Invalid end channel verification, valid range is 1 to 126");this.__device.channels.verification.end=e}set listenOnPort(t){if(t=parseInt(t),isNaN(t)||t<1||t>31)throw new Error("Invalid port number, valid range is 1 to 31");this.__internal__.device.listen_on_port=t,this.__internal__.serial.bytes_connection=this.serialSetConnectionConstant(t),this.__internal__.device.hex_number=(128+this.listenOnPort).toString(16)}get listenOnPort(){return this.__internal__.device.listen_on_port??1}serialJofemarMakeBytes(t){let e=this.hexToDec(this.sumHex(t)),n=this.calcCheckSums(e.toString());for(let o=0;o<2;o++)t.push(this.hexMaker(n[o]));return t.push("03"),this.add0x(t)}calcCheckSums(t){t=this.add0x([this.decToHex(parseInt(t).toString())]);let e=[];return e.push((t&255|240).toString(16).toUpperCase()),e.push((t&255|15).toString(16).toUpperCase()),e}serialSetConnectionConstant(t=1){let e=["02","30","30",(128+t).toString(16),"53","FF","FF"],n=[];return e.forEach(o=>{n.push(this.hexMaker(o))}),this.serialJofemarMakeBytes(n)}serialMessage(t){let n={code:t,name:null,description:null,request:"unknown",no_code:0,additional:{machine:{hex:null,dec:null}}};switch(t[0]){case"02":n=i(this,l,ht).call(this,t,n,128);break;case"06":n=i(this,l,dt).call(this,t,n);break;case"15":n.name="Checksum error",n.description="The calculated checksum does not match the received checksum",n.no_code=38,i(this,l,F).call(this);break;default:n.name="unknown",n.description="The message received is unknown",n.no_code=404;break}this.dispatch("serial:message",n)}productRemovedContinueDispensing(){this.__internal__.dispense.elevator.locking_interval&&(this.__internal__.dispense.elevator.locking_time=0)}async dispense({selection:t=1,cart:e=!1}={}){if(t=parseInt(t),isNaN(t)||t<1||t>109)throw new Error("Invalid selection");const{channel:n,tray:o}=i(this,l,pt).call(this,t);this.__internal__.dispense.backup_dispense={selection:t,cart:e,channel:n,tray:o};let d=["02","30","30",this.__internal__.device.hex_number,"56",o,n];e&&(d[4]="4D"),d=i(this,l,M).call(this,d);let h;do h=await this.internalDispense(d),i(this,l,_t).call(this),h.error==="elevator-locked"?await i(this,l,rt).call(this):h.error==="no-response"&&await J(1e3);while(["elevator-locked","no-response"].includes(h.error));return this.__internal__.dispense.backup_dispense={},h}async endDispense(){let e=["02","30","30",this.__internal__.device.hex_number,"4D","80","80"];return e=i(this,l,M).call(this,e),await this.internalDispense(e)}async collect(){const t=i(this,l,M).call(this,["02","30","30","81","4E","FF","FF"]);return await i(this,l,A).call(this,t,"collect")}async resetSoldOutErrors(){return await i(this,l,ie).call(this,"80")}async resetWaitingProductRemovedError(){return await i(this,l,ie).call(this,"81")}async resetMachineErrors(){return this.__internal__.serial.queue.length===0?(i(this,l,ge).call(this),await i(this,l,ie).call(this,"FF")):new Promise(t=>{const e=setInterval(async()=>{this.__internal__.serial.queue.length>0||(clearInterval(e),await i(this,l,ie).call(this,"FF"),i(this,l,ge).call(this),t(!0))},100)})}async resetAllErrors(){return await this.resetSoldOutErrors(),await J(100),await this.resetWaitingProductRemovedError(),await J(100),await this.resetMachineErrors()}async status(){const t=i(this,l,M).call(this,["02","30","30","81","53","FF","FF"]);return await i(this,l,A).call(this,t,"status")}async lightsOn(){return await i(this,l,Ce).call(this,"81")}async lightsOff(){return await i(this,l,Ce).call(this,"80")}async program(t,e){const n=i(this,l,M).call(this,["02","30","30","81","50",t,e]);return await i(this,l,A).call(this,n,"program")}async programDisplayLanguage(t="spanish"){const e={spanish:"30",english:"31",french:"32"};if(!e[t])throw new Error("Invalid language");return await this.program("49",e[t])}async programBeeper({enable:t=!0}={}){const e=t?"31":"30";return await this.program("5A",e)}async programDisableWorkingTemperature(){if(this.__device.type==="iceplus")throw new Error("IcePlus does not support disable working temperature");return await this.program("54","80")}async programDisableThermometer(){return await this.programDisableWorkingTemperature()}async programWorkingTemperature({degrees:t=.5}={}){t=parseFloat(t);const e=this.__device.type==="iceplus"?6.5:32,n=this.__device.type==="iceplus"?-25:.5;if(isNaN(t)||t<n||t>e||t%.5!==0)throw new Error("Invalid degrees");let o=t*2+128;return this.__device.type==="iceplus"&&(o+=51),o=Math.ceil(o),await this.program("54",o.toString(16))}async programIsolationTray({tray:t=0}={}){if(t=parseInt(t),isNaN(t)||t<0||t>12)throw new Error("Invalid tray, valid range is 0 to 12");const e=t===0?"80":(t+139).toString(16);return this.program("42",e)}async programTimeToStandbyAfterCollect({seconds:t=15}={}){if(t=parseInt(t),isNaN(t)||t<15||t>120)throw new Error("Invalid seconds, valid range is 15 to 120");const e=(128+t).toString(16);return await this.program("46",e)}async programTimeToStandbyWithoutCollect({minutes:t=1}={}){if(t=parseInt(t),isNaN(t)||t<1||t>10)throw new Error("Invalid minutes, valid range is 1 to 10");const e=(128+t).toString(16);return await this.program("48",e)}async programElevatorSpeed({speed:t="high"}={}){const e={high:"31",low:"30"};if(!e[t])throw new Error("Invalid speed, valid speeds are 'high' and 'low'");return await this.program("76",e[t])}async programTemperatureExpiration({enable:t=!1}={}){const e=t?"31":"30";return await this.program("63",e)}async programEnableTemperatureExpiration(){return await this.programTemperatureExpiration({enable:!0})}async programDisableTemperatureExpiration(){return await this.programTemperatureExpiration({enable:!1})}async programMachineAddress({address:t=1}={}){if(t=parseInt(t),isNaN(t)||t<1||t>31)throw new Error("Invalid address, valid range is 1 to 31");const e=(128+t).toString(16);return await this.program("64",e)}async programTemperatureBeforeExpiration({degrees:t=.5}={}){if(t=parseFloat(t),isNaN(t)||t<.5||t>30||t%.5!==0)throw new Error("Invalid degrees, valid range is 0.5 to 30");const e=(128+t*2).toString(16);return await this.program("65",e)}async programTimeBeforeExpirationByTemperature({minutes:t=1}={}){if(t=parseInt(t),isNaN(t)||t<1||t>120)throw new Error("Invalid minutes, valid range is 1 to 120");const e=(128+t).toString(16);return await this.program("66",e)}async programTemperatureScale({scale:t="c"}={}){const e={c:"43",f:"46"};if(!e[t])throw new Error("Invalid scale, valid scales are 'c' for celsius and 'f' for fahrenheit");return await this.program("67",e[t])}async programVoltageEngine({selection:t=1,voltage:e=5}={}){if(e=parseFloat(e),t=parseInt(t),isNaN(t)||t<1||t>80)throw new Error("Invalid selection, valid range is 1 to 80");if(isNaN(e)||e<5||e>9.5||e%.5!==0)throw new Error("Invalid voltage, valid range is 5 to 9.5");const n=109+t,c=(128+(e-5)*2).toString(16),d=i(this,l,M).call(this,["02","30","30","81","47",n,c]);return await i(this,l,A).call(this,d,"voltage-engine")}async programPushOverProducts({selection:t=1,enable:e=!0}={}){if(t=parseInt(t),isNaN(t)||t<1||t>80)throw new Error("Invalid selection, valid range is 1 to 80");const n=109+t,o=e?"31":"30",c=i(this,l,M).call(this,["02","30","30","81","4F",n,o]);return await i(this,l,A).call(this,c,"push-over-products")}async programChannelRunningAfterDispense({selection:t=1,seconds:e=0}={}){if(t=parseInt(t),e=parseFloat(e),isNaN(t)||t<1||t>126)throw new Error("Invalid selection, valid range is 1 to 126");if(isNaN(e)||e<0||e>10)throw new Error("Invalid seconds, valid range is 0.0 to 10.0");const n=109+t;e=e.toFixed(1);const o=128+e*10,c=i(this,l,M).call(this,["02","30","30","81","45",n,o]);return await i(this,l,A).call(this,c,"channel-running-after-dispense")}async checkData(t,e="FF"){const n=i(this,l,M).call(this,["02","30","30","81","43",t,e]);return await i(this,l,A).call(this,n,"check-data")}async getDisplayLanguage(){return await this.checkData("49")}async getBeeper(){return await this.checkData("5A")}async getWorkingTemperature(){return await this.checkData("54")}async getIsolationTray(){return await this.checkData("42")}async getProgramVersion(){return await this.checkData("50")}async getFaults(){return await this.checkData("53")}async getMachineId(){return await this.checkData("4E")}async getCurrentTemperature(){return await this.checkData("74")}async getTimeToStandbyAfterCollect(){return await this.checkData("46")}async getTimeToStandbyWithoutCollect(){return await this.checkData("48")}async getElevatorSpeed(){return await this.checkData("76")}async getTemperatureExpiration(){return await this.checkData("63")}async getTemperatureBeforeExpiration(){return await this.checkData("65")}async getTimeBeforeExpirationByTemperature(){return await this.checkData("66")}async getTemperatureScale(){return await this.checkData("67")}async getClockRegisters(){return await this.checkData("72")}async getMachineActivity(){return await this.checkData("41")}async getVoltageEngine({selection:t=1}={}){if(t=parseInt(t),isNaN(t)||t<1||t>126)throw new Error("Invalid selection, valid range is 1 to 126");const e=(109+t).toString(16);return await this.checkData("47",e)}async getChannelPresence({selection:t=1}={}){if(t=parseInt(t),isNaN(t)||t<1||t>126)throw new Error("Invalid selection, valid range is 1 to 126");const e=(109+t).toString(16);return await this.checkData("43",e)}async getPushOverProducts({selection:t=1}={}){if(t=parseInt(t),isNaN(t)||t<1||t>126)throw new Error("Invalid selection, valid range is 1 to 126");const e=(109+t).toString(16);return await this.checkData("4F",e)}async getChannelRunningAfterDispense({selection:t=1}={}){if(t=parseInt(t),isNaN(t)||t<1||t>126)throw new Error("Invalid selection, valid range is 1 to 126");const e=(109+t).toString(16);return await this.checkData("45",e)}async setDisplayStandbyMessage({message:t=""}={}){t=t.substring(0,32);const e=i(this,l,pe).call(this,t);return await i(this,l,de).call(this,"80",e)}async setDisplayMessageTemporarily({message:t="",seconds:e=1}){if(t=t.substring(0,32),e=parseInt(e),isNaN(e)||e<1||e>125)throw new Error("Invalid seconds, valid range is 1 to 125");const n=i(this,l,pe).call(this,t),o=(128+e).toString(16);return await i(this,l,de).call(this,o,n)}async setDisplayMessageUnlimited({message:t=""}){t=t.substring(0,32);const e=i(this,l,pe).call(this,t);return await i(this,l,de).call(this,"FF",e)}async programClock(t=new Date){if(!(t instanceof Date))throw new Error("Invalid date, must be an instance of Date");const e=i(this,l,M).call(this,["02","30","30","81","72",...i(this,l,bt).call(this,t)]);return await i(this,l,A).call(this,e,"clock")}async eventsConfig({event:t=null,enable:e=!0}={}){if(t===null)throw new Error("Invalid event");const n=e?"31":"30",o=i(this,l,M).call(this,["02","30","30","81","41",t,n]);return await i(this,l,A).call(this,o,"events-config")}async eventEnable({event:t=null}={}){if(t===null)throw new Error("Invalid event");const e=parseInt(t,16);if(isNaN(e)||e<38||e>100)throw new Error("Invalid event");return await this.eventsConfig({event:t,enable:!0})}async eventDisable({event:t=null}={}){if(t===null)throw new Error("Invalid event");const e=parseInt(t,16);if(isNaN(e)||e<38||e>100)throw new Error("Invalid event");return await this.eventsConfig({event:t,enable:!1})}async sendCustomCode(t=[]){if(t.length<5)throw new Error("Invalid code, minimum length is 5");const e=i(this,l,M).call(this,t);return await i(this,l,A).call(this,e,"custom")}async assignChannels(){const t=this.__device.channels.verification.start,e=this.__device.channels.verification.end;if(t>e)throw new Error("Invalid range, start must be less than end");this.__device.channels.verification.clear(),this.__device.channels.verification.running=!0;for(let n=t;n<=e;n++)this.__device.channels.verification.current=n,await this.getChannelPresence({selection:n});return new Promise(n=>{let o=setInterval(()=>{this.__device.channels.verification.channels.length===e-t+1&&(clearInterval(o),this.dispatch("channels",{channels:this.__device.channels.verification.channels}),this.__device.channels.verification.clear(),n(!0))},500)})}}l=new WeakSet,tt=function(){const t=["serial:command-executed","keyboard:pressed","door:opened","door:closed","door:event","jofemar:warning","jofemar:error","channels"];for(const e of t)this.serialRegisterAvailableListener(e)},nt=function(){this.on("internal:dispense:running",()=>i(this,l,ft))},it=function(){Q.add(this)},A=function(t,e){return t[3]=this.__internal__.device.hex_number,this.appendToQueue(i(this,l,M).call(this,t),e)},M=function(t){let e=this.hexToDec(this.sumHex(t)),n=this.calcCheckSums(e.toString());for(let o=0;o<2;o++)t.push(this.hexMaker(n[o]));return t.push("03"),t},rt=async function(){if(this.__internal__.dispense.elevator.locking_interval)return;this.__internal__.dispense.elevator.need_reset&&(this.__internal__.dispense.elevator.need_reset=!1,await this.resetWaitingProductRemovedError(),await J(500)),await this.collect();const t=this;return this.__internal__.dispense.status="elevator-locked",this.__internal__.dispense.elevator.locking_time=60,new Promise(e=>{t.__internal__.dispense.elevator.locking_interval=setInterval(()=>{t.dispatch("dispensing:withdrawal",{elevator:!0,seconds:t.__internal__.dispense.elevator.locking_time,description:"Please recall products from elevator"}),t.__internal__.dispense.elevator.locking_time-=1,t.__internal__.dispense.elevator.locking_time<=0&&(clearInterval(t.__internal__.dispense.elevator.locking_interval),t.__internal__.dispense.elevator.locking_interval=0,e(!0))},1e3)})},st=function(t,e){return e.name="ok",e.description="The last command was executed successfully",e.no_code=1,this.dispatch("serial:command-executed",e),e},at=function(t,e){e.key={hex:t,dec:this.hexToDec(t),ascii:null};const n={30:"0",31:"1",32:"2",33:"3",34:"4",35:"5",36:"6",37:"7",38:"8",39:"9","2a":"*",23:"#",41:"A",42:"B",43:"C",44:"D"};return e.key.ascii=n[t]??null,e.name="key pressed",e.description=`The key ${e.key.ascii} was pressed`,e.no_code=2,this.dispatch("keyboard:pressed",e),e},ot=function(t,e){return e.additional={door:{open:!1}},e.no_code=3,t==="4f"?(e.name="door open",e.description="The door was opened",this.dispatch("door:opened",e)):t==="43"?(e.name="door close",e.description="The door was closed",this.dispatch("door:closed",e)):(e.name="door event",e.description="The door event received is unknown",this.dispatch("door:event",e)),e},lt=function(t,e){e.no_code=404;let n=t[5]??null;return n&&this.listenOnPort>1&&(n=this.hexToDec(n)-this.listenOnPort+1,n=this.decToHex(n)),n&&(n==="FD"?(e.no_code=4,e.name="channel disconnected",e.description="The channel is disconnected",e.additional={active:!1}):n==="FC"?(e.no_code=5,e.name="channel connected",e.description="The channel is connected",e.additional={active:!0}):(e.no_code=6,e.name="channel sold out",e.description="The channel is empty",e.additional={active:!0}),this.__device.channels.verification.running&&(this.__device.channels.verification.channels.push({selection:this.__device.channels.verification.current,active:e.additional.active}),e.additional.selection=this.__device.channels.verification.current)),e},ct=function(t,e){return e.no_code=7,e.name="working temperature",e.description=`The working temperature is ${t}`,e.additional={hex:t,temperature:{traditional:(this.hexToDec(t)-this.hexToDec("80"))/2,ice_plus:(this.hexToDec(t)-this.hexToDec("80"))/2-25.5}},this.dispatch("temperature:working",e.additional),e},ut=function(t,e){return e.no_code=8,e.name="current temperature",e.additional={sign:null,tens:null,units:null,decimals:null,type_degrees:null,formatted:null,decimal_point:t[7]==="2e"?".":null,degrees:t[9]==="7f"?"":null},t[4]==="2b"?e.additional.sign=t[4]="+":["2e","2d"].includes(t[4])&&(e.additional.sign=t[4]="-"),this.hexToDec(t[5])>=48&&this.hexToDec(t[5])<=57&&(e.additional.tens=this.hexToDec(t[5])-48),this.hexToDec(t[6])>=48&&this.hexToDec(t[6])<=57&&(e.additional.units=this.hexToDec(t[6])-48),this.hexToDec(t[8])>=48&&this.hexToDec(t[8])<=57&&(e.additional.decimals=this.hexToDec(t[8])-48),t[10]==="43"?e.additional.type_degrees="C":t[10]==="46"&&(e.additional.type_degrees="F"),e.additional.formatted=(e.additional.sign??"")+(e.additional.tens??"")+(e.additional.units??"")+(e.additional.decimal_point??"")+(e.additional.decimals??"")+(e.additional.degrees??"")+(e.additional.type_degrees??""),e.description=`The current temperature is ${e.additional.formatted}`,this.dispatch("temperature:current",e.additional),e},ht=function(t,e,n=128){if(t[1]&&(e.additional.machine.hex=t[1],e.additional.machine.dec=this.hexToDec(t[1])-n),!(t[1]&&t[2]))e=i(this,l,st).call(this,t,e);else switch(t[2]){case"54":e.request="--automatic",e=i(this,l,at).call(this,t[3],e);break;case"50":e.request="--automatic",e=i(this,l,ot).call(this,t[3],e);break;case"43":switch(t[3]){case"43":e.request="channel-status",e=i(this,l,lt).call(this,t,e);break;case"54":e.request="working-temperature",e=i(this,l,ct).call(this,t[4],e);break;case"74":e.request="current-temperature",e=i(this,l,ut).call(this,t,e);break}break}return e},j=function(){this.__internal__.dispense.dispensing&&(this.__internal__.dispense.status=!0)},F=function(){this.__internal__.dispense.dispensing&&(this.__internal__.dispense.status=!1)},he=function(){this.__internal__.dispense.dispensing&&(this.__internal__.dispense.status="elevator-locked")},P=function({type:t=null,severity:e="low"}={}){this.dispatch("jofemar:warning",{type:t,severity:e})},U=function({type:t=null,severity:e="high"}={}){this.dispatch("jofemar:error",{type:t,severity:e})},dt=function(t,e){if(e.request="status",t[1]&&!t[2])switch(t[1]){case"30":e.name="Machine ready",e.description="The machine is ready for instructions",e.no_code=9,i(this,l,j).call(this);break;case"31":e.name="Machine busy",e.description="The machine is busy right now",e.no_code=10;break;case"32":e.name="Invalid tray",e.description="The tray requested is invalid",e.no_code=11,i(this,l,F).call(this),i(this,l,P).call(this,{type:"invalid-tray"});break;case"33":e.name="Invalid channel",e.description="The channel requested is invalid",e.no_code=12,i(this,l,F).call(this),i(this,l,P).call(this,{type:"invalid-channel"});break;case"34":e.name="Empty channel",e.description="The channel requested is empty",e.no_code=13,i(this,l,F).call(this),i(this,l,P).call(this,{type:"empty-channel"});break;case"35":e.name="Jam",e.description="Jam in elevator engine",e.no_code=14,i(this,l,F).call(this),i(this,l,U).call(this,{type:"jam"});break;case"36":e.name="Malfunction",e.description="Malfunction in the elevator belt or product detector",e.no_code=15,i(this,l,F).call(this),i(this,l,U).call(this,{type:"malfunction"});break;case"37":e.name="Photo transistors",e.description="Failure in one of the photo transistors in the cabinet",e.no_code=16,i(this,l,F).call(this),i(this,l,U).call(this,{type:"photo-transistors"});break;case"38":e.name="Without channels",e.description="No channels detected",e.no_code=17,i(this,l,F).call(this),i(this,l,U).call(this,{type:"without-channels"});break;case"39":e.name="Product detector fault",e.description="Product detector fault",e.no_code=18,i(this,l,he).call(this),i(this,l,P).call(this,{type:"fault-product-detector"});break;case"41":e.name="Fault in 485 BUS",e.description="Machine display is disconnected",e.no_code=19,i(this,l,j).call(this),i(this,l,P).call(this,{type:"display-disconnected"});break;case"42":e.name="Product under elevator",e.description="Product alarm under elevator",e.no_code=20,i(this,l,F).call(this),i(this,l,P).call(this,{type:"product-under-elevator"});break;case"43":e.name="Error when elevator approaching to a position",e.description="Error when elevator approaching to a position",e.no_code=21,i(this,l,j).call(this),i(this,l,P).call(this,{type:"error-approaching-position",severity:"high"});break;case"44":e.name="Fault in keyboard",e.description="Fault in keyboard",e.no_code=22,i(this,l,F).call(this),i(this,l,U).call(this,{type:"fault-keyboard"});break;case"45":e.name="Eeprom writing error",e.description="Eeprom writing error",e.no_code=23,i(this,l,F).call(this),i(this,l,U).call(this,{type:"eeprom-writing-error",severity:"extreme"});break;case"46":e.name="Fault communicating with temperature control",e.description="Fault communicating with temperature control",e.no_code=24,i(this,l,j).call(this),i(this,l,P).call(this,{type:"fault-temperature-control"});break;case"47":e.name="Thermometer disconnected",e.description="The thermometer is disconnected",e.no_code=25,i(this,l,j).call(this),i(this,l,P).call(this,{type:"thermometer-disconnected"});break;case"48":e.name="Thermometer programming lost",e.description="Thermometer programming lost",e.no_code=26,i(this,l,j).call(this),i(this,l,P).call(this,{type:"thermometer-programming-lost"});break;case"49":e.name="Thermometer faulty",e.description="Thermometer faulty",e.no_code=27,i(this,l,j).call(this),i(this,l,P).call(this,{type:"thermometer-faulty"});break;case"4a":e.name="Channels power consumption detector faulty",e.description="Channels power consumption detector faulty",e.no_code=28,i(this,l,F).call(this),i(this,l,U).call(this,{type:"channels-power-consumption-detector-faulty",severity:"extreme"});break;case"4b":e.name="Elevator does not find channel or tray",e.description="Elevator does not find channel or tray",e.no_code=29,i(this,l,F).call(this),i(this,l,P).call(this,{type:"elevator-not-find-channel-tray"});break;case"4c":e.name="Elevator does not find delivery product position",e.description="Elevator does not find delivery product position",e.no_code=30,i(this,l,F).call(this),i(this,l,U).call(this,{type:"elevator-not-find-delivery-position"});break;case"4d":e.name="Interior of elevator blocked",e.description="Interior of elevator blocked",e.no_code=31,i(this,l,he).call(this),this.__internal__.dispense.elevator.need_reset||(this.__internal__.dispense.elevator.need_reset=!0),i(this,l,U).call(this,{type:"interior-elevator-blocked",severity:"low"});break;case"4e":e.name="Error in tester of product detector",e.description="Error in tester of product detector",e.no_code=32,i(this,l,F).call(this),i(this,l,U).call(this,{type:"error-tester-product-detector"});break;case"4f":e.name="Waiting for product to be removed",e.description="Waiting for product to be removed",e.no_code=33,i(this,l,he).call(this);break;case"50":e.name="Product expired by temperature reasons",e.description="Product expired by temperature reasons",e.no_code=34,i(this,l,j).call(this),i(this,l,P).call(this,{type:"product-expired-temperature"});break;case"51":e.name="Automatic door faulty",e.description="Automatic door faulty",e.no_code=35,i(this,l,j).call(this),i(this,l,P).call(this,{type:"automatic-door-faulty"});break;case"59":case"5a":case"61":case"62":case"63":switch(e.name="Product is expired",e.description="Product is expired",e.additional={nsf_alarm:1},t[1]){case"5a":e.additional.nsf_alarm=2;break;case"61":e.additional.nsf_alarm=3;break;case"62":e.additional.nsf_alarm=4;break;case"63":e.additional.nsf_alarm=5;break}e.no_code=36,i(this,l,j).call(this),i(this,l,P).call(this,{type:"product-expired"});break;case"64":e.name="Product detector didn't change during its verification test",e.description="Product detector didn't change during its verification test",e.no_code=37,i(this,l,j).call(this),i(this,l,P).call(this,{type:"automatic-door-faulty"});break}else e.name="executed",e.description="The last command was executed successfully",e.no_code=8,!t[1]&&this.__internal__.dispense.dispensing&&i(this,l,F).call(this);return e},pt=function(t){if(t=t.toString(),t.length!==3)throw new Error("Invalid selection");const e=(parseInt(t.substring(0,2))+128).toString(16).padStart(2,"0");return{channel:(parseInt(t.substring(2,3))+128).toString(16).padStart(2,"0"),tray:e}},_t=function(){this.__internal__.dispense.timeout&&clearTimeout(this.__internal__.dispense.timeout),this.__internal__.dispense.interval&&clearInterval(this.__internal__.dispense.interval),this.__internal__.dispense.timeout=0,this.__internal__.dispense.interval=0},ft=function(){const t=this;t.__internal__.dispense.timeout=setTimeout(()=>{t.__internal__.dispense.interval=setInterval(()=>{t.status().then(()=>{})},t.__internal__.dispense.interval_time)},t.__internal__.dispense.timeout_time)},ie=async function(t){const e=i(this,l,M).call(this,["02","30","30","81","52",t,"FF"]);return await i(this,l,A).call(this,e,"reset")},ge=function(){this.dispatch("reset:errors",{description:"Resetting all machine errors",duration:this.__device.type==="esplus"?Me(25):Me(40),started_at:new Date})},Ce=async function(t){const e=i(this,l,M).call(this,["02","30","30","81","4C",t,"FF"]);return await i(this,l,A).call(this,e,"lights")},de=async function(t="80",e=[]){const n=i(this,l,M).call(this,["02","30","30","81","44",t,...e]);return await i(this,l,A).call(this,n,"display")},pe=function(t=""){t=t.padEnd(32," ");const e=[];for(let n=0;n<32;n++)e.push(t.charCodeAt(n).toString(16));return e},bt=function(t){if(!(t instanceof Date))throw new Error("Invalid date, must be an instance of Date");const e=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0"),c=(t.getMonth()+1).toString().padStart(2,"0"),d=t.getFullYear().toString().substring(2,4),h=`${e}:${n} ${o}-${c}-${d}`,k=[];for(let x=0;x<14;x++)k.push(h.charCodeAt(x).toString(16));return k};class Be extends K{constructor({filters:t=null,config_port:e=null,no_device:n=1}={}){super({filters:t,config_port:e,no_device:n});B(this,u);q(this,"__coin_purse",{available:!0});q(this,"__banknote_purse",{available:!0,isRecycler:!0,recycler:{ict:!0,banknote:1}});q(this,"__sale",{price:0,change:0,change_verified:0,dispense_all:!0,last_change:0,clear(){this.price=0,this.change=0,this.change_verified=0,this.dispense_all=!0,this.last_change=0}});q(this,"__money_session",{inserted:0,retired:0,clear(){this.inserted=0,this.retired=0}});q(this,"coins",{tubes:{g50:0,c50:0,p1:0,p2:0,p5:0,p10:0},box:{g50:0,c50:0,p1:0,p2:0,p5:0,p10:0},totals:{g50:0,c50:0,p1:0,p2:0,p5:0,p10:0},total:0});q(this,"banknotes",{stacker:{p20:0,p50:0,p100:0,p200:0,p500:0,p1000:0},recycler:{p20:0,p50:0,p100:0,p200:0,p500:0,p1000:0},out:{p20:0,p50:0,p100:0,p200:0,p500:0,p1000:0},totals:{p20:0,p50:0,p100:0,p200:0,p500:0,p1000:0},total:0});q(this,"card_reader",{available:!1,max_pre_credit:0});B(this,Z,!1);B(this,V,0);B(this,$,0);this.__internal__.device.type="boardroid",this.__internal__.serial.config_port.baudRate=115200,this.__internal__.serial.response.length=14,this.__internal__.time.response_connection=600,this.__internal__.time.response_general=4e3,this.__internal__.dispense.limit_counter=15,this.__internal__.dispense.backup_dispense={channel:1,second_channel:null,sensor:!0,seconds:null},i(this,u,wt).call(this),i(this,u,yt).call(this)}get totalInTubes(){return this.coins.tubes.g50*.5+this.coins.tubes.c50*.5+this.coins.tubes.p1+this.coins.tubes.p2*2+this.coins.tubes.p5*5+this.coins.tubes.p10*10}get totalInRecycler(){return this.banknotes.recycler.p20*20+this.banknotes.recycler.p50*50+this.banknotes.recycler.p100*100+this.banknotes.recycler.p200*200+this.banknotes.recycler.p500*500+this.banknotes.recycler.p1000*1e3}get hasRecycler(){return this.__banknote_purse.available&&this.__banknote_purse.isRecycler}get hasCoinPurse(){return this.__coin_purse.available}set price(t){let e=parseFloat(t);(isNaN(e)||e<0)&&(e=0),this.__sale.price=e}get price(){return this.__sale.price}get change(){return this.__sale.price<=0||this.__money_session.inserted<=this.__sale.price?0:this.__money_session.inserted-this.__sale.price}softReload(){super.softReload(),this.__sale.clear(),this.__money_session.clear()}serialBoardroidSumHex(t){let e=0;return t.forEach((n,o)=>{o!==0&&o!==11&&(e+=parseInt(n,16))}),e.toString(16).toUpperCase()}serialMessage(t){let e={code:t,name:null,description:null,request:null,no_code:0};const n=(5+this.deviceNumber).toString(16).padStart(2,"0").toLowerCase();switch(t[1]){case n:e.request="connect",e=i(this,u,vt).call(this,e);break;case"a0":e.request="--automatic",e=i(this,u,St).call(this,t,e);break;case"b0":e.request="--automatic",e=i(this,u,It).call(this,t,e);break;case"d0":e.request="coin-purse:config",e=i(this,u,Et).call(this,t[2],e);break;case"d1":e.request="banknote-purse:config",e.additional={scrow:null},e=i(this,u,Mt).call(this,t,e);break;case"d2":e.request="coin-purse:read-tubes",e=i(this,u,Ft).call(this,t,e);break;case"d3":e.request="banknote-purse:read-recycler",e=i(this,u,Pt).call(this,t,e);break;case"d4":e.request="banknote-purse:banknote-scrow-status",e=i(this,u,Nt).call(this,t[2],e);break;case"d5":e.request="banknote-purse:dispense",e=i(this,u,Bt).call(this,t,e);break;case"d6":e.request="coin-purse:dispense",e=i(this,u,Rt).call(this,t,e);break;case"d7":e.request="dispense",e=i(this,u,qt).call(this,t[5],e);break;case"d8":e.request="status:door",e=i(this,u,At).call(this,t[13],e);break;case"d9":e.request="status:temperature",e=i(this,u,Ht).call(this,t,e);break;case"da":e.request="status:relay",e=i(this,u,Lt).call(this,t[2],e);break;case"db":e.request="banknote-purse:save-memory",e.no_code=18,e.name="Bill purse memory saved?",e.description="The memory of bill purse was saved successfully?",this.dispatch("banknote-purse:save-memory",{message:e});break;case"dc":e.request="coin-purse:read-memory",e.no_code=19,e.name="Coin purse memory read?",e.description="The memory of coin purse was read successfully?",this.dispatch("banknote-purse:read-memory",{message:e});break;case"dd":e.request="card-reader",i(this,u,Ot).call(this,t,e);break;default:e.request="--unknown",e.name="Response unrecognized",e.description="The response of application was received, but dont identify with any of current parameters",e.no_code=400,this.dispatch("unknown",e);break}this.dispatch("serial:message",e)}serialSetConnectionConstant(t=1){let e=["F1","06","00","00","00","00","00","00","00","00","F2","F8"];return e[1]=this.hexMaker(this.decToHex((5+t).toString())),e[11]=this.serialBoardroidSumHex(e),this.add0x(e)}async coinPurseConfigure({enable:t=!1,high:e="FF",low:n="FF"}={}){if(!this.__coin_purse.available)throw new Error("Coin purse not available");const c=["F1","C1",t?"01":"00",e,n,"00","00","00","00","00","F2","00"];await i(this,u,H).call(this,c,"coin-purse:config")}async coinPurseEnable(){await this.coinPurseConfigure({enable:!0})}async coinPurseDisable(){await this.coinPurseConfigure({enable:!1})}async coinPurseDispense({$_50c:t=0,$_1:e=0,$_2:n=0,$_5:o=0,$_10:c=0}={}){if(!this.__coin_purse.available)throw new Error("Coin purse not available");if([t,e,n,o,c].some(h=>isNaN(h)||typeof h=="string"))throw new Error("One of the values is not a number");if(t<1&&e<1&&n<1&&o<1&&c<1)throw new Error("No coins to dispense");[t,e,n,o,c]=[this.decToHex(t),this.decToHex(e),this.decToHex(n),this.decToHex(o),this.decToHex(c)];let d=["F1","C6",t,e,n,o,c,"00","00","00","F2","00"];await i(this,u,H).call(this,d,"coin-purse:dispense")}async coinPurseReadTubes(){const t=["F1","C2","00","00","00","00","00","00","00","00","F2","00"];await i(this,u,H).call(this,t,"coin-purse:read-tubes")}async banknotePurseConfigure({enable:t=!1,scrow:e=!1}={}){if(!this.__banknote_purse.available)throw new Error("Banknote purse not available");let n;return i(this,u,_e).call(this)?n=i(this,u,jt).call(this,{enable:t,scrow:e}):n=i(this,u,Ut).call(this,{enable:t,scrow:e}),await i(this,u,H).call(this,n,"banknote-purse:config")}async banknotePurseDispense({$_20:t=0,$_50:e=0,$_100:n=0,$_200:o=0,$_500:c=0,$_1000:d=0}={}){if(!this.__banknote_purse.available)throw new Error("Banknote purse not available");if(!this.__banknote_purse.isRecycler)throw new Error("Banknote purse is not recycler");let h;if(i(this,u,_e).call(this)){const k=[t,e,n,o,c];h=i(this,u,Wt).call(this,k[this.__banknote_purse.recycler.banknote])}else h=i(this,u,Qt).call(this,{$_20:t,$_50:e,$_100:n,$_200:o,$_500:c,$_1000:d});await i(this,u,H).call(this,h,"banknote-purse:dispense")}async banknotePurseEnable({scrow:t=!1}){return await this.banknotePurseConfigure({enable:!0,scrow:t})}async banknotePurseDisable(){return await this.banknotePurseConfigure({enable:!1})}async banknotePurseAcceptInScrow(){if(!this.__banknote_purse.available)throw new Error("Banknote purse not available");const t=["F1","C4","01","00","00","00","00","00","00","00","F2","00"];await i(this,u,H).call(this,t,"banknote-purse:banknote-scrow-status")}async banknotePurseRejectInScrow(){if(!this.__banknote_purse.available)throw new Error("Banknote purse not available");const t=["F1","C4","00","00","00","00","00","00","00","00","F2","00"];await i(this,u,H).call(this,t,"banknote-purse:banknote-scrow-status")}async banknotePurseSaveMemory({channel:t=null,$_20:e=null,$_50:n=null,$_100:o=null,$_200:c=null,$_500:d=null,$_1000:h=null}={}){if(!this.__banknote_purse.available)throw new Error("Banknote purse not available");if(t===null||e===null||n===null||o===null||c===null||d===null||h===null)throw new Error("One of the values is not defined");const k=["F1","C8",this.decToHex(t),"00",this.decToHex(e),this.decToHex(n),this.decToHex(o),this.decToHex(c),this.decToHex(d),this.decToHex(h),"F2","00"];await i(this,u,H).call(this,k,"banknote-purse:save-memory")}async banknotePurseReadRecycler(){if(!this.__banknote_purse.available)throw new Error("Banknote purse not available");if(!this.__banknote_purse.isRecycler)throw new Error("Banknote purse is not recycler");const t=["F1","C3","00","00","00","00","00","00","00","00","F2","B5"];return await i(this,u,H).call(this,t,"banknote-purse:read-recycler")}async cardReaderDisable(){if(!this.card_reader.available)throw new Error("Card reader not available");const t=["F1","CD","00","00","00","00","00","00","00","00","F2","00"];return await i(this,u,H).call(this,t,"card-reader:disable")}async cardReaderDispense({channel:t=1,second_channel:e=null,sensor:n=!0,seconds:o=null,price:c=0}={}){if(!this.card_reader.available)throw new Error("Card reader not available");if(isNaN(this.card_reader.max_pre_credit)||this.card_reader.max_pre_credit===0)throw new Error("Card reader pre-credit not configured");if(isNaN(c)||c<=0)throw new Error("Price must be greater than 0");if(c>this.card_reader.max_pre_credit)throw new Error("Price is greater than pre-credit configured");if(!n&&(o===null||o<=0||o>25.4))throw new Error("Invalid time to dispense without sensor");const d=this.decToHex(c/256),h=this.decToHex(c%256),k=this.decToHex(t+9);let x="00";e&&(x=this.decToHex(e+9));let I="00";n||(I=this.decToHex(o*10));const O=["F1","CD","01",k,x,I,d,h,"00","00","F2","00"];await i(this,u,H).call(this,O,"card-reader:dispense")}async paymentPursesDisable({coin:t=!0,banknote:e=!0,cardReader:n=!1}={}){t&&await this.coinPurseDisable(),e&&await this.banknotePurseDisable(),n&&await this.cardReaderDisable()}async paymentPursesEnable({coin:t=!0,banknote:e=!0,scrowBanknote:n=!1}={}){t&&await this.coinPurseEnable(),e&&await this.banknotePurseEnable({scrow:n})}async coolingRelayConfigure({enable:t=!1}={}){const n=["F1","CC",t?"01":"00","00","00","00","00","00","00","00","F2","00"];return await i(this,u,H).call(this,n,"status:relay")}async coolingRelayEnable(){return await this.coolingRelayConfigure({enable:!0})}async coolingRelayDisable(){return await this.coolingRelayConfigure({enable:!1})}async readTemperature(){const t=["F1","CB","00","00","00","00","00","00","00","00","F2","00"];return await i(this,u,H).call(this,t,"status:temperature")}async dispense({selection:t=1,second_selection:e=null,sensor:n=!0,seconds:o=null,retry:c=!1}={}){if(t=parseInt(t),isNaN(t)||t<1||t>80)throw new Error("Invalid channel number");if(e!==null&&(e<1||e>80||e===t))throw new Error("Invalid second channel number");if(!n&&(o===null||o<=0||o>25.4))throw new Error("Invalid time to dispense without sensor");c&&(this.__internal__.dispense.backup_dispense={selection:t,second_selection:e,sensor:n,seconds:o}),t+=9;const d=this.decToHex(t);let h="00";e&&(e+=9,h=this.decToHex(e));let k="00";n||(k=this.decToHex(o*10));const x=i(this,u,fe).call(this,["F1","C7",d,h,k,"00","00","00","00","00","F2","00"]);let I=await this.internalDispense(x);return!I.dispensed&&c&&(I=await this.internalDispense(x)),I}async testEngines({singleEngine:t=!1}={}){if(this.isDispensing)throw new Error("Another dispensing process is running");i(this,u,De).call(this),T(this,Z,!0);const e=[];i(this,u,be).call(this);for(let n=1;n<=80;n++){const o=await this.dispense({selection:n,second_selection:t?null:n+1,sensor:!1,seconds:.4,retry:!1});e.push(o),T(this,V,n),i(this,u,be).call(this),t||n++}T(this,V,80),i(this,u,be).call(this,{dispensed:e}),i(this,u,De).call(this)}async sendCustomCode(t){t=i(this,u,fe).call(this,t),await this.appendToQueue(t,"custom")}hasToReturnChange(t=0){let e=t;return e<=0?!0:(e=i(this,u,xe).call(this,e).pending,e=i(this,u,Se).call(this,e).pending,!(e>0))}async returnChange(){return await i(this,u,Ie).call(this)}async returnInsertedMoney(){return this.__money_session.inserted<=0?!1:await i(this,u,Ie).call(this,this.__money_session.inserted)}async serialCorruptMessage(t,e){console.log("Corrupt message",t,e)}}Z=new WeakMap,V=new WeakMap,$=new WeakMap,u=new WeakSet,wt=function(){const t=["run:default-load","session:money-dispensed","session:money-request","coin-purse:reject-lever","coin-purse:reset","coin-purse:coin-event","banknote-purse:event-banknote","coin-purse:tubes","banknote-purse:recycler","status:door","status:temperature","status:relay","card-reader:event","coin-purse:config","banknote-purse:config","banknote-purse:banknote-scrow-status","percentage:test","change:pending"];for(const e of t)this.serialRegisterAvailableListener(e)},yt=function(){Q.add(this)},_e=function(){return this.__banknote_purse.isRecycler&&this.__banknote_purse.recycler.ict},kt=function(){return this.hasCoinPurse||this.hasRecycler},vt=function(t){return t.name="Connection with the serial device completed.",t.description="Your connection with the serial device was successfully completed.",t.no_code=1,this.dispatch("run:default-load",{}),t},mt=function(t){const e={g50:["40","50","60","70","90"],c50:["41","51","61","71","91"],p1:["42","52","62","72","92"],p2:["43","53","63","73","93"],p5:["44","54","64","74","94"],p10:["45","55","65","75","95"],p20:["47","57","67","77","97"]};let n=null;for(let c in e)if(e[c].includes(t)){n=c;break}return n?[{g50:"50 pennies (the big one)",c0:"50 pennies (the little one)",p1:"1 peso",p2:"2 pesos",p5:"5 pesos",p10:"10 pesos",p20:"20 pesos"}[n],n]:[`Undefined value: ${t}?`,null]},gt=function(t){return["g50","c50","p1","p2","p5","p10","p20"].includes(t)},Ct=function(t){const e={p20:["80","90","a0","b0"],p50:["81","91","a1","b1"],p100:["82","92","a2","b2"],p200:["83","93","a3","b3"],p500:["84","94","a4","b4"],p1000:["85","95","a5","b5"]};let n=null;for(let c in e)if(e[c].includes(t)){n=c;break}return n?[{p20:"20 pesos",p50:"50 pesos",p100:"100 pesos",p200:"200 pesos",p500:"500 pesos",p1000:"1000 pesos"}[n],n]:[`Undefined value: ${t}?`,null]},Tt=function(t){return["p20","p50","p100","p200","p500","p1000"].includes(t)},Dt=function(t){return["r20","r50","r100"].includes(t)},xt=function(){return["r20","r50","r100","r200","r500"][this.__banknote_purse.recycler.banknote]},Te=function(t,e){if(!t)return;let n=!0;if(i(this,u,gt).call(this,t)){if(typeof this.coins.tubes[t]>"u")return;e==="tube"?this.coins.tubes[t]+=1:e==="box"&&(this.coins.box[t]+=1);let o=0;["g50","c50"].includes(t)?o=.5:o+=parseInt(t.slice(1)),this.coins.totals[t]+=o,this.__money_session.inserted+=o,this.coins.total+=o}else if(i(this,u,Tt).call(this,t)){if(typeof this.banknotes.tubes[t]>"u")return;e==="recycler"?this.banknotes.recycler[t]+=1:e==="stacker"&&(this.banknotes.stacker[t]+=1);let o=parseInt(t.slice(1));this.banknotes.totals[t]+=o,this.__money_session.inserted+=o,this.banknotes.total+=o}else if(i(this,u,Dt).call(this,t)&&e==="out"){if(typeof this.banknotes.out[t]>"u")return;this.banknotes.out[t]+=1;let o=parseInt(t.slice(1));this.__money_session.retired+=o,this.banknotes.recycler[t]-=1,this.banknotes.total-=o,n=!1,this.dispatch("session:money-dispensed",{type_money:t,retired:o,finish:!1,type:"banknotes"})}n&&this.dispatch("session:money-request",{})},St=function(t,e){const n=parseInt(t[2],16);return e.name="Coin Inserted",e.no_code=2,e.additional={where:null,coin:null},n===1?(e.name="Lever pressed",e.description="Reject lever",e.no_code=100,this.dispatch("coin-purse:reject-lever",{})):n===2?(e.name="Reset coin purse",e.description="The configuration of coin purse was reset",e.no_code=101,this.dispatch("coin-purse:reset",{})):n>=64&&n<=79?(e.name="Coin inserted in profit box",e.additional.where="box"):n>=80&&n<=95?(e.name="Coin inserted in tube",e.additional.where="tube"):n>=96&&n<=111?(e.name="Unused coin",e.description="Something come from coin changer but in MDB Docs is unused",e.additional.where="unused"):n>=112&&n<=127?(e.name="Coin rejected",e.additional.where="rejected"):n>=144&&n<=159?(e.name="Coin dispensed",e.additional.where="out",e.description=`Undefined value: ${t[2]}?`):(e.name="Coin inserted",e.description="Undefined status. Without information of this",e.no_code=400),n===1||n===2||n>=160||n>=128&&n<=143||([e.description,e.additional.coin]=i(this,u,mt).call(this,t[2]),e.no_code=38+n,i(this,u,Te).call(this,e.additional.coin,e.additional.where),["tube","out"].includes(e.additional.where)&&this.dispatch("coin-purse:tubes",this.coins.tubes),this.dispatch("coin-purse:coin-event",this.coins)),e},It=function(t,e){const n=parseInt(t[2],16);return e.name="Banknote Inserted",e.no_code=2,e.additional={where:null,banknote:null},n===42?(e.name="Banknote dispensed",e.description="Banknote dispensed by request.",e.additional.banknote=i(this,u,xt).call(this),e.additional.where="out",e.no_code=200):n>=128&&n<=143?(e.name="Banknote inserted",e.additional.where="stacker"):n>=144&&n<=159?(e.name="Banknote inserted in pre stacker",e.additional.where="tmp"):n>=160&&n<=175?(e.name="Banknote rejected",e.additional.where="nothing"):n>=176&&n<=191&&(e.name="Banknote inserted",e.additional.where="recycler"),n>=128&&n<=191&&([e.description,e.additional.banknote]=i(this,u,Ct).call(this,t[2]),e.no_code=74+n),i(this,u,Te).call(this,e.additional.banknote,e.additional.where),this.dispatch("banknote-purse:event-banknote",this.banknotes),e},Et=function(t,e){const n=parseInt(t,16);return n===1?(e.name="Coin purse enabled",e.description="Configuration complete, enabled",e.no_code=3):n===0?(e.name="Coin purse disabled",e.description="Disabled by system request",e.no_code=4):(e.name="Status unknown",e.description="The response of coin purse doesn't identify successfully",e.no_code=400),this.dispatch("coin-purse:config",{status:n===1}),e},Mt=function(t,e){const n=parseInt(t[2],16),o=parseInt(t[3],16);return n===0?(e.name="Bill purse disabled",e.description="Configuration complete, disabled"):n===1&&(e.name="Bill purse enabled",e.description="Configuration complete, enabled"),o===0?e.additional.scrow="Scrow disabled, banknote received automatic":o===1&&(e.additional.scrow="Scrow enabled, require manual action"),e.no_code=5,this.dispatch("banknote-purse:config",{status:n===1,scrow:o===1}),e},Ft=function(t,e){e.no_code=6;const[n,o,c,d,h,k]=[parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseInt(t[5],16),parseInt(t[6],16),parseInt(t[7],16)];return e.additional={coins:{g50:n,c50:o,p1:c,p2:d,p5:h,p10:k}},this.coins.tubes.g50=n,this.coins.tubes.c50=o,this.coins.tubes.p1=c,this.coins.tubes.p2=d,this.coins.tubes.p5=h,this.coins.tubes.p10=k,this.coins.totals.g50=(this.coins.box.g50+n)*.5,this.coins.totals.c50=(this.coins.box.c50+o)*.5,this.coins.totals.p1=this.coins.box.p1+c,this.coins.totals.p2=(this.coins.box.p2+d)*2,this.coins.totals.p5=(this.coins.box.p5+h)*5,this.coins.totals.p10=(this.coins.box.p10+k)*10,this.coins.total=this.coins.totals.g50+this.coins.totals.c50+this.coins.totals.p1+this.coins.totals.p2+this.coins.totals.p5+this.coins.totals.p10,e.name="Read tubes",e.description="Quantity of coins approximated",this.dispatch("coin-purse:tubes",this.coins.tubes),e},Pt=function(t,e){e.no_code=7;const[n,o,c,d,h,k]=[parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseInt(t[5],16),parseInt(t[6],16),parseInt(t[7],16)];return e.additional={banknotes:{b20:n,b50:o,b100:c,b200:d,b500:h,b1000:k}},this.banknotes.recycler.p20=n,this.banknotes.recycler.p50=o,this.banknotes.recycler.p100=c,this.banknotes.recycler.p200=d,this.banknotes.recycler.p500=h,this.banknotes.recycler.p1000=k,this.banknotes.totals.p20=(this.banknotes.stacker.p20+n)*20,this.banknotes.totals.p50=(this.banknotes.stacker.p50+o)*50,this.banknotes.totals.p100=(this.banknotes.stacker.p100+c)*100,this.banknotes.totals.p200=(this.banknotes.stacker.p200+d)*200,this.banknotes.totals.p500=(this.banknotes.stacker.p500+h)*500,this.banknotes.totals.p1000=(this.banknotes.stacker.p1000+k)*1e3,this.banknotes.total=this.banknotes.totals.p20+this.banknotes.totals.p50+this.banknotes.totals.p100+this.banknotes.totals.p200+this.banknotes.totals.p500+this.banknotes.totals.p1000,e.name="Read recycler",e.description="Quantity of banknotes approximated",this.dispatch("banknote-purse:recycler",this.banknotes.recycler),e},Nt=function(t,e){const n=parseInt(t,16);return n===1?e.name="Banknote accepted":n===0?e.name="Banknote rejected":e.name="Unknown status banknote",e.no_code=8,this.dispatch("banknote-purse:banknote-scrow-status",{status:n===1}),e},Bt=function(t,e){const[n,o,c,d,h,k]=[parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseInt(t[5],16),parseInt(t[6],16),parseInt(t[7],16)],x=n*20+o*50+c*100+d*200+h*500+k*1e3;return e.name="Banknotes dispensed",e.description=x>0?"Banknotes dispensed by request":"No banknotes dispensed, recycler empty",e.no_code=9,e.additional={banknotes:{b20:n,b50:o,b100:c,b200:d,b500:h,b1000:k},total_dispensed:x},this.dispatch("session:money-dispensed",{type_money:null,retired:null,finish:!1,type:"banknotes",data:e}),e},Rt=function(t,e){return e.name="Coins dispensed",e.no_code=10,e.description="Coins dispensed by request",isNaN(this.__sale.last_change)&&(this.__sale.last_change=0),this.__money_session.retired+=this.__sale.last_change,this.dispatchAsync("session:money-dispensed",{type_money:null,retired:null,finish:!1,type:"coins"},500),e},qt=function(t,e){const n=parseInt(t,16);return n===1?(e.name="Product not delivered",e.description="The product requested wasn't delivered",e.no_code=11,this.__internal__.dispense.status=!1):n===0?(e.name="Product delivered",e.description="The product requested was delivered",e.no_code=12,this.__internal__.dispense.status=!0):(e.name="Unknown status product",e.description="The response of product doesn't identify successfully",e.no_code=400,this.__internal__.dispense.status=!1),this.dispatch("dispensed",{}),e},At=function(t,e){let n="closed";return t==="db"?(e.name="Door closed",e.no_code=13):t==="dc"?(e.name="Door open",e.no_code=14,n="open"):(e.name="Unknown status door",e.description="The response of door doesn't identify successfully",e.no_code=400,n="unknown"),this.dispatch("status:door",{status:n}),e},Ht=function(t,e){const n=parseInt(t[2],16)*255,o=parseInt(t[3],16),c=(n+o)*.1;return e.no_code=15,e.name="Temperature status",e.description=`Temperature: ${c}`,e.additional={high:n,low:o,temperature:parseFloat(c.toString())},this.dispatch("status:temperature",e.additional),e},Lt=function(t,e){const n=parseInt(t,16);let o="unknown";return n===1?(e.name="Relay on",e.description="Relay on",e.no_code=16,o="on"):n===0?(e.name="Relay off",e.description="Relay off",e.no_code=17,o="off"):(e.name="Status unknown",e.description="Status unknown",e.no_code=400),this.dispatch("status:relay",{status:o}),e},Ot=function(t,e){const n=parseInt(t[2],16);if(e.no_code=20+n,e.name="Status unknown",e.description="The status of card reader does not identified correctly",e.no_code=400,n===0)e.request+=":disable",e.name="Card reader disabled",e.description="Card reader device was disabled successfully";else if(n===1||n===2)e.request+=":dispense",e.name="Card reader enabled",e.description="Card reader device is now enabled";else if(n===3)e.request+=":pre-authorize",e.name="Pre-authorized credit",e.description="The pre credit was authorized successfully";else if(n===4)e.request+=":cancel",e.name="Cancellation in progress",e.description="Cancellation request done successfully";else if(n===5)e.request+=":sell",e.name="Sell approved",e.description="Sell approved, starting dispense product";else if(n===6)e.request+=":sell",e.name="Sell denied",e.description="This sell was denied, try again";else if(n===7)e.request+=":end",e.name="Session ended",e.description="The session ended";else if(n===8)e.request+=":cancel",e.name="Cancelled",e.description="Cancellation complete";else if(n===10){const o=parseInt(t[8],16);o===0?(e.no_code=30,e.name="product not dispensed",e.description="The product requested wasn't delivered"):o===1&&(e.no_code=31,e.name="product dispensed",e.description="The product requested was delivered")}return this.dispatch("card-reader:event",e),e},H=function(t,e){return this.appendToQueue(i(this,u,fe).call(this,t),e)},fe=function(t){return t[11]=this.serialBoardroidSumHex(t),t.map((e,n)=>{t[n]=this.hexMaker(e)}),t},jt=function({enable:t=!1,scrow:e=!1}={}){const n=t?"FF":"00",o=e?"FF":"00";return["F1","C0",n,n,o,o,"00","00","00","00","F2","00"]},Ut=function({enable:t=!1,scrow:e=!1}={}){return["F1","C0",t?"01":"00",e?"01":"00","00","00","00","00","00","00","F2","00"]},Wt=function(t=1){if(t<1)throw new Error("No banknotes to dispense");return t=this.decToHex(t),["F1","C5",this.decToHex(this.__banknote_purse.recycler.banknote.toString()),t,"00","00","00","00","00","00","F2","00"]},Qt=function({$_20:t=0,$_50:e=0,$_100:n=0,$_200:o=0,$_500:c=0,$_1000:d=0}={}){if([t,e,n,o,c,d].some(h=>isNaN(h)||typeof h=="string"))throw new Error("One of the values is not a number");if(t<1&&e<1&&n<1&&o<1&&c<1&&d<1)throw new Error("No banknotes to dispense");return[t,e,n,o,c,d]=[this.decToHex(t),this.decToHex(e),this.decToHex(n),this.decToHex(o),this.decToHex(c),this.decToHex(d)],["F1","C5",t,e,n,o,c,d,"00","00","F2","00"]},De=function(){T(this,Z,!1),T(this,V,0),T(this,$,0)},be=function({dispensed:t=null,limit:e=80}={}){T(this,$,Math.round(b(this,V)*100/e)),this.dispatch("percentage:test",{percentage:b(this,$),dispensed:t})},Jt=function(t){const e=["20","50","100","200","500"],n="$_"+e[this.__banknote_purse.recycler.banknote],o=parseInt(e[this.__banknote_purse.recycler.banknote]),c=parseInt((t/o).toString()),d={banknotes:{$_20:0,$_50:0,$_100:0,$_200:0,$_500:0,$_1000:0},pending:t,will_dispense:c>0};return this.totalInRecycler===0||c<1||t===0||(d.banknotes[n]=c,d.pending=t%o),d},Vt=function(t){const e={banknotes:{$_20:0,$_50:0,$_100:0,$_200:0,$_500:0,$_1000:0},pending:t,will_dispense:!1};return this.totalInRecycler===0||t===0||(e.banknotes.$_1000=parseInt((t/1e3).toString()),e.pending=t%1e3,e.banknotes.$_500=parseInt((e.pending/500).toString()),e.pending=e.pending%500,e.banknotes.$_200=parseInt((e.pending/200).toString()),e.pending=e.pending%200,e.banknotes.$_100=parseInt((e.pending/100).toString()),e.pending=e.pending%100,e.banknotes.$_50=parseInt((e.pending/50).toString()),e.pending=e.pending%50,e.banknotes.$_20=parseInt((e.pending/20).toString()),e.pending=e.pending%20,e.will_dispense=e.banknotes.$_1000>0||e.banknotes.$_500>0||e.banknotes.$_200>0||e.banknotes.$_100>0||e.banknotes.$_50>0||e.banknotes.$_20>0),e},xe=function(t){return i(this,u,_e).call(this)?i(this,u,Jt).call(this,t):i(this,u,Vt).call(this,t)},Se=function(t){const e={coins:{$_50c:0,$_1:0,$_2:0,$_5:0,$_10:0},pending:t,will_dispense:!1};return t<=0||this.totalInTubes===0||(e.coins.$_10=parseInt((t/10).toString()),e.pending=t%10,e.coins.$_5=parseInt((e.pending/5).toString()),e.pending=e.pending%5,e.coins.$_2=parseInt((e.pending/2).toString()),e.pending=e.pending%2,e.coins.$_1=parseInt(e.pending),e.pending=e.pending%1,e.coins.$_50c=parseInt((e.pending/.5).toString()),e.pending=e.pending%.5,e.will_dispense=e.coins.$_10>0||e.coins.$_5>0||e.coins.$_2>0||e.coins.$_1>0||e.coins.$_50c>0),e},Ie=async function(t=null){if(!i(this,u,kt).call(this))throw new Error("Change not available");let e=this.change,n=this.change;if(t!==null&&(e=t,n=t),n<=0)return!1;const o=i(this,u,xe).call(this,n);n=o.pending;const c=i(this,u,Se).call(this,n);return n=c.pending,n>0&&this.dispatch("change:pending",{pending:n}),n===e?!1:(o.will_dispense&&await this.banknotePurseDispense(o.banknotes),c.will_dispense&&await this.coinPurseDispense(c.coins),!0)};const en={Relay:Fe,Locker:Pe,Jofemar:Ne,Boardroid:Be,Devices:Q,Emulator:Y,version:"3.0.0"};y.Boardroid=Be,y.Devices=Q,y.Emulator=Y,y.Jofemar=Ne,y.Locker=Pe,y.Relay=Fe,y.WebSerial=en,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
